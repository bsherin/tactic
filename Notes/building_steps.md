## building for production or development
change again

### build all docker containers or any necessary:
In `tactic_app` directory:

`docker-compose build` or `docker-compose build tactic_main`

Now there are x86 and arm64 images that are built. To build the arm64 images (which is what I want on apple silicon)
then I do: `docker-compose build tactic_main_arm64`

I made bash scripts. so now can do:

`dbuild_arm host` or `dbuild host`
or
`dbuild_arm all` or `dbuild all`

### build javascript bundles and css using webpack
from the `tactic` directory

note that scripts that can be run with `npm run`, as below are specified in package.json
The webpack configuration is in webpack.config.js

#### Develop

run either:
`webpack —env.mode=development`, or `npm run build`
Note: I need to type `export NODE_OPTIONS=--openssl-legacy-provider` for executing the webpack commands.
It's discussed in `webpack and npm.md`

#### production
run either:
`webpack —env.mode=production`
or
`npm run build-production`

note that the `npm run …` commands run a named script from package.json

### To push out a new version:

* Make sure that all files generated by webpack (for the production version) are marked as relevant by git.
* Push changes to github
    * note that the flask config file in `tactic_app/config.py` is no longer part of the repository.
    I think this shouldn't matter because I build my images locally.
* On github, pull changes onto master if necessary
* Push images to docker hub: 
  * might have to do "docker login" first
    * `docker login -u bsherin -p geeb%%`
  * run the script `push_images.sh` to push just the x86 images.

## to push out new version to AWS server
* ssh into server and run `/srv/tactic/tactic_app/update_server_and_relaunch.sh`
* can run the apple shortcut that does this in one step

## To push out to old northwestern server
* run these scripts (They require a vpn connection)

```
>/az_resdocker/  # actually I haven't been doing this lately
>/azdeploy/  # Just to change directories
>/azplay/
# alternatively, if I want to also update the nginx config:
# see discussion in readme.md in the tactic-azure-development project
> ansible-playbook -i staging deploy_with_nginxupdate.yml

# also if I just want to pull over the source code from git, can do
> ansible-playbook -i staging deploy_pull_github_only.yml
# or just pull new docker images and relaunch server
> ansible-playbook -i staging deploy_pull_images_only.yml
```

to launch with new shell scripts
```
> ansible-playbook -i staging deploy_shell_scripts.yml
```
