!function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=31)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return a})),s.d(t,"d",(function(){return r})),s.d(t,"f",(function(){return l})),s.d(t,"g",(function(){return p})),s.d(t,"e",(function(){return c}));let i={};function o(e){let t=e.callback_id,s=i[t];delete i[t],s(e.response_data)}function n(e,t,s){"/"==e[0]&&(e=e.slice(1)),$.ajax({url:$SCRIPT_ROOT+"/"+e,contentType:"application/json",type:"POST",async:!0,data:JSON.stringify(t),dataType:"json",success:s})}function a(e,t){return new Promise((function(s,i){"/"==e[0]&&(e=e.slice(1)),$.ajax({url:$SCRIPT_ROOT+"/"+e,contentType:"application/json",type:"POST",async:!0,data:JSON.stringify(t),dataType:"json",success:e=>{e.success&&s(e),i(e)}})}))}function r(e,t){return new Promise((function(s,i){"/"==e[0]&&(e=e.slice(1)),$.ajax({url:$SCRIPT_ROOT+"/"+e,type:"POST",data:t,contentType:!1,processData:!1,success:e=>{e.success&&s(e),i(e)}})}))}function l(e,t,s,o){const n={source:"client",dest:e,task_type:t,task_data:s,response_data:null,main_id:main_id,expiration:null};if(void 0!==o&&null!=o){const e=guid();i[e]=o,n.callback_id=e,n.callback_type="callback_no_context"}else n.callback_id=null,n.callback_type="no_callback";$.ajax({url:$SCRIPT_ROOT+"/post_from_client",contentType:"application/json",type:"POST",async:!0,data:JSON.stringify(n),dataType:"json"})}function c(e,t,s){const i={source:"client",dest:e,task_type:t,task_data:s,response_data:null,main_id:main_id,callback_id:null,callback_type:"no_callback",expiration:null};$.ajax({url:$SCRIPT_ROOT+"/post_from_client",contentType:"application/json",type:"POST",async:!1,data:JSON.stringify(i),dataType:"json"})}function p(e,t,s,o){const n={source:"client",dest:e,task_type:t,task_data:s,response_data:null,expiration:null};if(void 0!==o){const e=guid();i[e]=o,n.callback_id=e,n.callback_type="callback_no_context"}else n.callback_id=null,n.callback_type="no_callback";$.ajax({url:$SCRIPT_ROOT+"/post_from_client",contentType:"application/json",type:"POST",async:!0,data:JSON.stringify(n),dataType:"json"})}},function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"c",(function(){return l})),s.d(t,"d",(function(){return c})),s.d(t,"a",(function(){return p}));var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},o=blueprint;const n=o.Toaster.create({className:"recipe-toaster",position:o.Position.TOP,autoFocus:!0}),a={"alert-success":"Success","alert-warning":"Warning","alert-info":null};function r(e){let t;t=e.hasOwnProperty("alert_type")?a[e.alert_type]:null,n.show({message:e.message,intent:t})}function l(e){r(e)}function c(e,t=null){return class extends React.Component{constructor(e){super(e),doBinding(this),this.tsocket=t,this.state={show_spinner:!1,status_message:null,dark_spinner:!1,spinner_size:this.props.spinner_size?this.props.spinner_size:25}}componentDidMount(){this.tsocket&&(this.tsocket.socket.on("stop-spinner",this._stopSpinner),this.tsocket.socket.on("start-spinner",this._startSpinner),this.tsocket.socket.on("show-status-msg",this._statusMessageFromData),this.tsocket.socket.on("clear-status-msg",this._clearStatusMessage))}_stopSpinner(){this.setState({show_spinner:!1})}_startSpinner(e=!1){this.setState({show_spinner:!0,dark_spinner:e})}_clearStatusMessage(){this.setState({status_message:null})}_clearStatus(){this.setState({show_spinner:!1,status_message:null})}_statusMessage(e,t=null){this.setState({status_message:e},()=>{t&&setTimeout(self._clearStatusMessage,1e3*data.timeout)})}_statusMessageFromData(e){let t=this;this.setState({status_message:e.message},()=>{e.hasOwnProperty("timeout")&&null!=e.timeout&&setTimeout(t._clearStatusMessage,1e3*e.timeout)})}_setStatus(e){this.setState(e)}_statusFuncs(){return{startSpinner:this._startSpinner,stopSpinner:this._stopSpinner,clearStatus:this._clearStatus,clearStatusMessage:this._clearStatusMessage,statusMessage:this._statusMessage,setStatus:this._setStatus}}render(){return React.createElement(React.Fragment,null,React.createElement(e,i({},this.props,{statusFuncs:this._statusFuncs(),startSpinner:this._startSpinner,stopSpinner:this._stopSpinner,clearStatus:this._clearStatus,clearStatusMessage:this._clearStatus,statusMessage:this._statusMessage,setStatus:this._setStatus})),React.createElement(p,this.state))}}}class p extends React.Component{render(){this.props.dark_spinner;return React.createElement("div",{className:"d-flex flex-row",style:{position:"absolute",bottom:10,marginLeft:15}},this.props.show_spinner&&React.createElement(o.Spinner,{className:"bp3-dark",size:20}),this.props.status_message&&React.createElement("div",{className:"d-flex flex-column justify-content-around",style:{positoin:"absolute",marginLeft:50}},React.createElement("div",{id:"status-msg-area",className:"bp3-ui-text"},this.props.status_message)))}}p.propTypes={show_spinner:PropTypes.bool,status_message:PropTypes.string,spinner_size:PropTypes.number},p.defaultProps={show_spinner:!1,status_message:null,spinner_size:25}},function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return c})),s.d(t,"c",(function(){return r}));var i=blueprint;class o extends React.Component{constructor(e){super(e),doBinding(this);let t=this.props.default_value;for(var s=1;this.name_exists(t);)s+=1,t=this.props.default_value+String(s);this.state={show:!1,current_value:t,checkbox_states:{},warning_text:""}}_changeHandler(e){this.setState({current_value:e.target.value})}_checkbox_change_handler(e){e.target.checked;let t=Object.assign({},this.state.checkbox_states);t[e.target.id]=e.target.checked,this.setState({checkbox_states:t})}componentDidMount(){if(this.setState({show:!0}),null!=this.props.checkboxes&&0!=this.props.checkboxes.length){let e={};for(let t of this.props.checkboxes)e[t.id]=!1;this.setState({checkbox_states:e})}}name_exists(e){return this.props.existing_names.indexOf(e)>-1}_submitHandler(e){let t;""==this.state.current_value?(t="An empty name is not allowed here.",this.setState({warning_text:t})):this.name_exists(this.state.current_value)?(t="That name already exists",this.setState({warning_text:t})):(this.setState({show:!1}),this.props.handleSubmit(this.state.current_value,this.state.checkbox_states),this.props.handleClose())}_cancelHandler(){this.setState({show:!1}),this.props.handleCancel&&this.props.handleCancel(),this.props.handleClose()}_refHandler(e){this.input_ref=e}render(){let e=[];if(null!=this.props.checkboxes&&0!=this.props.checkboxes.length)for(let t of this.props.checkboxes){let s=React.createElement(i.Checkbox,{checked:this.state.checkbox_states[t.checkname],label:t.checktext,id:t.checkname,key:t.checkname,onChange:this._checkbox_change_handler});e.push(s)}return React.createElement(i.Dialog,{isOpen:this.state.show,title:this.props.title,onClose:this._cancelHandler,onOpened:()=>{$(this.input_ref).focus()},canEscapeKeyClose:!0},React.createElement("form",{onSubmit:this._submitHandler},React.createElement("div",{className:i.Classes.DIALOG_BODY},React.createElement(i.FormGroup,{label:this.props.field_title,helperText:this.state.warning_text},React.createElement(i.InputGroup,{inputRef:this._refHandler,onChange:this._changeHandler,value:this.state.current_value})),0!=e.length&&e),React.createElement("div",{className:i.Classes.DIALOG_FOOTER},React.createElement("div",{className:i.Classes.DIALOG_FOOTER_ACTIONS},React.createElement(i.Button,{onClick:this._cancelHandler},"Cancel"),React.createElement(i.Button,{intent:i.Intent.PRIMARY,onClick:this._submitHandler},"Submit")))))}}function n(e,t,s,i,n,a=null,r=null){void 0===n&&(n=[]);let l=document.querySelector("#modal-area");ReactDOM.render(React.createElement(o,{handleSubmit:s,handleCancel:r,handleClose:function(){ReactDOM.unmountComponentAtNode(l)},title:e,field_title:t,default_value:i,checkboxes:a,existing_names:n}),l)}o.propTypes={handleSubmit:PropTypes.func,handleClose:PropTypes.func,title:PropTypes.string,field_title:PropTypes.string,default_value:PropTypes.string,existing_names:PropTypes.array,checkboxes:PropTypes.array},o.defaultProps={existing_names:[],default_value:"",checkboxes:null};class a extends React.Component{constructor(e){super(e),doBinding(this),this.state={show:!1,value:null}}componentDidMount(){this.setState({show:!0,value:this.props.option_list[0]})}_handleChange(e){this.setState({value:e.target.value})}_submitHandler(e){this.setState({show:!1}),this.props.handleSubmit(this.state.value),this.props.handleClose()}_cancelHandler(){this.setState({show:!1}),this.props.handleClose()}render(){return React.createElement(i.Dialog,{isOpen:this.state.show,title:this.props.title,onClose:this._cancelHandler,canEscapeKeyClose:!0},React.createElement("div",{className:i.Classes.DIALOG_BODY},React.createElement(i.FormGroup,{title:this.props.select_label},React.createElement(i.HTMLSelect,{options:this.props.option_list,onChange:this._handleChange,value:this.state.value}))),React.createElement("div",{className:i.Classes.DIALOG_FOOTER},React.createElement("div",{className:i.Classes.DIALOG_FOOTER_ACTIONS},React.createElement(i.Button,{onClick:this._cancelHandler},"Cancel"),React.createElement(i.Button,{intent:i.Intent.PRIMARY,onClick:this._submitHandler},"Submit"))))}}function r(e,t,s,i,o,n){let r=document.querySelector("#modal-area");ReactDOM.render(React.createElement(a,{handleSubmit:o,handleClose:function(){ReactDOM.unmountComponentAtNode(r)},title:e,select_label:t,submit_text:i,option_list:n,cancel_text:s}),r)}a.propTypes={handleSubmit:PropTypes.func,handleClose:PropTypes.func,handleCancel:PropTypes.func,title:PropTypes.string,select_label:PropTypes.string,option_list:PropTypes.array,submit_text:PropTypes.string,cancel_text:PropTypes.string};class l extends React.Component{constructor(e){super(e),doBinding(this),this.state={show:!1}}componentDidMount(){this.setState({show:!0})}_submitHandler(e){this.setState({show:!1}),this.props.handleSubmit(),this.props.handleClose()}_cancelHandler(){this.setState({show:!1}),this.props.handleClose()}render(){return React.createElement(i.Dialog,{isOpen:this.state.show,title:this.props.title,onClose:this._cancelHandler,canEscapeKeyClose:!0},React.createElement("div",{className:i.Classes.DIALOG_BODY},React.createElement("p",null,this.props.text_body)),React.createElement("div",{className:i.Classes.DIALOG_FOOTER},React.createElement("div",{className:i.Classes.DIALOG_FOOTER_ACTIONS},React.createElement(i.Button,{onClick:this._cancelHandler},"Cancel"),React.createElement(i.Button,{intent:i.Intent.PRIMARY,onClick:this._submitHandler},"Submit"))))}}function c(e,t,s,i,o){let n=document.querySelector("#modal-area");ReactDOM.render(React.createElement(l,{handleSubmit:o,handleClose:function(){ReactDOM.unmountComponentAtNode(n)},title:e,text_body:t,submit_text:i,cancel_text:s}),n)}l.propTypes={handleSubmit:PropTypes.func,handleClose:PropTypes.func,title:PropTypes.string,text_body:PropTypes.string,submit_text:PropTypes.string,cancel_text:PropTypes.string};(class extends React.Component{constructor(e){super(e),doBinding(this),this.state={show:!1}}componentDidMount(){this.setState({show:!0})}_closeHandler(){this.setState({show:!1}),this.props.handleClose()}render(){return React.createElement(i.Dialog,{isOpen:this.state.show,title:this.props.title,onClose:this._closeHandler,canEscapeKeyClose:!0},React.createElement("div",{className:i.Classes.DIALOG_BODY},React.createElement("p",null,this.props.text_body)),React.createElement("div",{className:i.Classes.DIALOG_FOOTER},React.createElement("div",{className:i.Classes.DIALOG_FOOTER_ACTIONS},React.createElement(i.Button,{onClick:this._closeHandler},"Okay"))))}}).propTypes={handleClose:PropTypes.func,title:PropTypes.string,text_body:PropTypes.string,close_text:PropTypes.string}},function(e,t,s){"use strict";s.d(t,"d",(function(){return l})),s.d(t,"c",(function(){return r})),s.d(t,"e",(function(){return c})),s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return a})),s.d(t,"f",(function(){return n}));let i=blueprint,o=bptable;function n(e){return class extends React.Component{render(){if(this.props.tooltip){let t=this.props.tooltipDelay?this.props.tooltipDelay:1e3;return React.createElement(i.Tooltip,{content:this.props.tooltip,hoverOpenDelay:t},React.createElement(e,this.props))}return React.createElement(e,this.props)}}}class a extends React.Component{render(){let e=null==this.props.style?{paddingLeft:2,paddingRight:2}:this.props.style;return React.createElement(i.Button,{type:"button",minimal:this.props.minimal,small:!0,style:e,onMouseDown:e=>{e.preventDefault()},onClick:this.props.handleClick,intent:this.props.intent,icon:this.props.icon},this.props.extra_glyph_text&&React.createElement("span",{className:"extra-glyph-text"},this.props.extra_glyph_text))}}a.propTypes={icon:PropTypes.string,minimal:PropTypes.bool,extra_glyph_text:PropTypes.string,style:PropTypes.object,handleClick:PropTypes.func,intent:PropTypes.string},a.defaultProps={style:null,extra_glyph_text:null,minimal:!0,intent:"none"},a=n(a);(class extends React.Component{constructor(e){super(e),doBinding(this),this.state={xpos:0,ypos:0,initial_x:null,initial_y:null,active:!1}}_dragStart(e){this.setState({initial_x:e.clientX,initial_y:e.clientY,active:!0})}_drag(e){if(this.state.active){let t=e.clientX-this.state.initial_x,s=e.clientY-this.state.initial_y;this.setState({xpos:t,ypos:s})}}_dragEnd(e){this.setState({active:!1,xpos:0,ypos:0})}render(){let e={fontSize:25};return this.state.active&&(e.transform="translate3d("+this.state.xpos+"px, "+this.state.ypos+"px, 0)"),React.createElement("span",{style:e,onMouseDown:this._dragStart,onMouseMove:this._drag,onMouseUp:this._dragEnd,className:"fal fa-caret-right"})}}).propTypes={handleDrag:PropTypes.func};class r extends React.Component{render(){return React.createElement(i.FormGroup,{label:this.props.label,style:{marginRight:5}},React.createElement(i.InputGroup,{onChange:this.props.onChange,value:this.props.the_value}))}}function l(e){return React.createElement(i.FormGroup,{label:e.label,style:{marginRight:5}},React.createElement(i.HTMLSelect,{options:e.option_list,onChange:e.onChange,value:e.the_value}))}r.propTypes={show:PropTypes.bool,label:PropTypes.string,onChange:PropTypes.func,the_value:PropTypes.string},r.defaultProps={show:!0};class c extends React.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this)}handleChange(e){this.props.onChange(e.target.value)}render(){let e={marginBottom:5,width:"auto"};null!=this.props.height&&(e.height=this.props.height),null!=this.props.maxWidth&&(e.maxWidth=this.props.maxWidth),null!=this.props.fontSize&&(e.fontSize=this.props.fontSize);let t=this.props.option_list.map((e,t)=>React.createElement("option",{key:t},e));return React.createElement(i.HTMLSelect,{style:e,onChange:this.handleChange,minimal:this.props.minimal,value:this.props.value},t)}}c.propTypes={option_list:PropTypes.array,onChange:PropTypes.func,minimal:PropTypes.bool,value:PropTypes.string,height:PropTypes.number,maxWidth:PropTypes.number,fontSize:PropTypes.number},c.defaultProps={height:null,maxWidth:null,fontSize:null,minimal:!1};class p extends React.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this),this.td_ref=React.createRef()}handleChange(e){let t=this.td_ref.current.innerHTML.trim();this.props.handleCellChange(this.props.theRow,this.props.theCol,t)}render(){return React.createElement("td",{contentEditable:this.props.content_editable,onBlur:this.handleChange,ref:this.td_ref,suppressContentEditableWarning:!0},this.props.children)}}p.propTypes={content_editable:PropTypes.bool,handleCellChange:PropTypes.func,theRow:PropTypes.number,theColumn:PropTypes.string};class _ extends React.Component{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.handleRowClick(this.props.row_index)}render(){let e=this.props.columns.map((e,t)=>React.createElement(p,{key:t,content_editable:this.props.content_editable,theRow:this.props.row_index,theCol:e,handleCellChange:this.props.handleCellChange},this.props.data_dict[e]));e.push(React.createElement("td",{key:"999"},React.createElement("span",{className:"ui-icon ui-icon-arrowthick-2-n-s"})));let t=this.props.active?"selector-button active":"selector-button";return React.createElement("tr",{className:t,id:this.props.row_index,onClick:this.handleClick},e)}}_.propTypes={columns:PropTypes.array,row_index:PropTypes.number,data_dict:PropTypes.object,active:PropTypes.bool,handleRowClick:PropTypes.func,content_editable:PropTypes.bool,handleCellChange:PropTypes.func},_.defaultProps={content_editable:!1};class h extends React.Component{render(){let e=this.props.columns.map((e,t)=>React.createElement("th",{key:t},e));return e.push(React.createElement("th",{key:"999"}," ")),React.createElement("thead",null,React.createElement("tr",{className:"selector-button",key:"header"},e))}}h.propTypes={columns:PropTypes.array};class d extends React.Component{constructor(e){super(e),doBinding(this)}_onRowsReordered(e,t){let s=[...this.props.data_array],i=s[e];s.splice(e,1),s.splice(t,0,i),this.props.handleChange(s)}_onConfirmCellEdit(e,t,s){let i=[...this.props.data_array];i[t][this.props.columns[s]]=e,this.props.handleChange(i)}_onSelection(e){0!=e.length&&e[0].hasOwnProperty("rows")&&this.props.handleActiveRowChange(e[0].rows[0])}_cellRendererCreator(e){let t=this;return s=>{let i;return i=Object.keys(t.props.data_array[s]).includes(e)?t.props.data_array[s][e]:"",React.createElement(o.EditableCell,{key:e,truncated:!0,rowIndex:s,columnIndex:this.props.columns.indexOf(e),wrapText:!0,onConfirm:t._onConfirmCellEdit,value:i})}}_rowHeaderCellRenderer(e){return React.createElement(o.RowHeaderCell,{key:e,name:e})}render(){let e=this,t=this.props.columns.map(t=>{const s=e._cellRendererCreator(t);return React.createElement(o.Column,{cellRenderer:s,enableColumnReordering:!1,key:t,name:t})});return React.createElement(o.Table,{enableFocusedCell:!0,numRows:this.props.data_array.length,enableColumnReordering:!1,selectionModes:[o.RegionCardinality.FULL_COLUMNS,o.RegionCardinality.FULL_ROWS],enableRowReordering:!0,onRowsReordered:this._onRowsReordered,onSelection:this._onSelection,enableMultipleSelection:!1},t)}}d.propTypes={columns:PropTypes.array,data_array:PropTypes.array,handleActiveRowChange:PropTypes.func,handleChange:PropTypes.func},d.defaultProps={content_editable:!1};class u extends React.Component{constructor(e){super(e),this.tbody_ref=React.createRef(),this.update_option_order=this.update_option_order.bind(this),this.handleCellChange=this.handleCellChange.bind(this)}componentDidMount(){$(this.tbody_ref.current).sortable({handle:".ui-icon",update:this.update_option_order})}handleCellChange(e,t,s){let i=this.props.data_array;i[e][t]=s,this.props.handleChange(i)}update_option_order(e,t){let s=$(this.tbody_ref.current).sortable("toArray"),i=s.indexOf(String(this.props.active_row)),o=s.map((e,t)=>this.props.data_array[parseInt(e)]);this.props.handleChange(o),this.props.handleActiveRowChange(i)}render(){let e=this.props.data_array.map((e,t)=>React.createElement(_,{columns:this.props.columns,data_dict:e,key:e[this.props.columns[0]],row_index:t,active:t==this.props.active_row,handleRowClick:this.props.handleActiveRowChange,content_editable:this.props.content_editable,handleCellChange:this.handleCellChange}));return React.createElement(i.HTMLTable,{style:{fontSize:12},bordered:!0,condensed:!0,interactive:!0,striped:!1},React.createElement(h,{columns:this.props.columns}),React.createElement("tbody",{ref:this.tbody_ref},e))}}u.propTypes={columns:PropTypes.array,data_array:PropTypes.array,active_row:PropTypes.number,handleActiveRowChange:PropTypes.func,handleChange:PropTypes.func,content_editable:PropTypes.bool},u.defaultProps={content_editable:!1}},,function(e,t,s){"use strict";s.d(t,"c",(function(){return l})),s.d(t,"a",(function(){return c})),s.d(t,"d",(function(){return p})),s.d(t,"b",(function(){return r}));var i=s(2),o=s(0),n=s(1);let a=blueprint;class r extends React.Component{constructor(e){super(e),doBinding(this)}_filter_on_match_list(e){return!this.props.hidden_items.includes(e)}render(){let e=Object.keys(this.props.option_dict).filter(this._filter_on_match_list).map((e,t)=>{let s=this.props.icon_dict.hasOwnProperty(e)?this.props.icon_dict[e]:null;return React.createElement(a.MenuItem,{disabled:this.props.disable_all||this.props.disabled_items.includes(e),onClick:this.props.option_dict[e],icon:s,key:e,text:e})}),t=React.createElement(a.Menu,null,e);if(this.props.alt_button){let e=this.props.alt_button;return React.createElement(a.Popover,{minimal:!0,content:t,position:a.PopoverPosition.BOTTOM_LEFT},React.createElement(e,null))}return React.createElement(a.Popover,{minimal:!0,content:t,position:a.PopoverPosition.BOTTOM_LEFT},React.createElement(a.Button,{text:this.props.menu_name,small:!0,minimal:!0}))}}r.propTypes={menu_name:PropTypes.string,option_dict:PropTypes.object,icon_dict:PropTypes.object,disabled_items:PropTypes.array,disable_all:PropTypes.bool,hidden_items:PropTypes.array,alt_button:PropTypes.func},r.defaultProps={disabled_items:[],disable_all:!1,hidden_items:[],icon_dict:{},alt_button:null};class l extends React.Component{constructor(e){super(e),doBinding(this)}_saveProjectAs(){this.props.startSpinner();let e=this;function t(){e.props.stopSpinner()}function s(t){const s={project_name:t,main_id:window.main_id,doc_type:"table",purgetiles:!0};function i(s){s.success?(window.is_project=!0,window._project_name=t,window.is_jupyter=!1,document.title=t,e.props.clearStatusMessage(),s.alert_type="alert-success",s.timeout=2e3,Object(o.f)("host","refresh_project_selector_list",{user_id:window.user_id}),e.props.updateLastSave(),e.props.stopSpinner(),Object(n.b)(s)):(e.props.clearStatusMessage(),s.message=s.message,s["alert-type"]="alert-warning",e.props.stopSpinner(),Object(n.b)(s))}s.interface_state=e.props.interface_state,window.is_notebook?Object(o.f)(window.main_id,"save_new_notebook_project",s,i):(s.purgetiles=!0,Object(o.f)(window.main_id,"save_new_project",s,i))}Object(o.f)("host","get_project_names",{user_id:window.user_id},(function(e){Object(i.b)("Save Project As","New Project Name",s,"NewProject",e.project_names,null,t)}))}_saveProject(){let e=this;const t={main_id:window.main_id,project_name:window._project_name};t.interface_state=this.props.interface_state,this.props.startSpinner(),Object(o.f)(window.main_id,"update_project",t,(function(t){e.props.startSpinner(),t.success?(t.alert_type="alert-success",t.timeout=2e3,e.props.updateLastSave()):t.alert_type="alert-warning";e.props.clearStatusMessage(),e.props.stopSpinner(),Object(n.b)(t)}))}_exportAsJupyter(){this.props.startSpinner();let e=this;function t(t){var s=[];for(let t of e.props.console_items){let e={};e.source=t.console_text,e.cell_type="code"==t.type?"code":"markdown","code"==t.type&&(e.outputs=[]),s.push(e)}const i={project_name:t,main_id:window.main_id,cell_list:s};Object(o.f)(window.main_id,"export_to_jupyter_notebook",i,(function(t){e.props.clearStatusMessage(),t.success?(t.alert_type="alert-success",t.timeout=2e3):t["alert-type"]="alert-warning";e.props.stopSpinner(),Object(n.b)(t)}))}Object(o.f)("host","get_project_names",{user_id:user_id},(function(e){Object(i.b)("Export Notebook in Jupyter Format","New Project Name",t,"NewJupyter",e.project_names,void 0)}))}_exportDataTable(){Object(i.b)("Export Data","New Collection Name",(function(e){const t={export_name:e,main_id:window.main_id,user_id:window.user_id};$.ajax({url:$SCRIPT_ROOT+"/export_data",contentType:"application/json",type:"POST",async:!0,data:JSON.stringify(t),dataType:"json"})}))}_consoleToNotebook(){const e={main_id:window.main_id,console_items:this.props.console_items,user_id:window.user_id};Object(o.f)(window.main_id,"console_to_notebook",e)}get option_dict(){return{"Save As...":this._saveProjectAs,Save:this._saveProject,"Export as Jupyter Notebook":this._exportAsJupyter,"Open Console as Notebook":this._consoleToNotebook,"Export Table as Collection":this._exportDataTable,"Change collection":this.props.changeCollection}}get icon_dict(){return{"Save As...":"floppy-disk",Save:"saved","Export as Jupyter Notebook":"export","Open Console as Notebook":"console","Export Table as Collection":"export","Change collection":"exchange"}}render(){return React.createElement(r,{menu_name:"Project",option_dict:this.option_dict,icon_dict:this.icon_dict,disabled_items:this.props.disabled_items,disable_all:!1,hidden_items:this.props.hidden_items})}}l.propTypes={console_items:PropTypes.array,interface_state:PropTypes.object,updateLastSave:PropTypes.func,changeCollection:PropTypes.func,disabled_items:PropTypes.array,hidden_items:PropTypes.array};class c extends React.Component{constructor(e){super(e),doBinding(this)}_shift_column_left(){let e=this.props.filtered_column_names.indexOf(this.props.selected_column);if(0==e)return;let t=this.props.filtered_column_names[e-1];this.props.moveColumn(this.props.selected_column,t)}_shift_column_right(){let e=this.props.table_spec.column_names.indexOf(this.props.selected_column);if(e==this.props.table_spec.column_names.length-1)return;let t=this.props.table_spec.column_names[e+2];this.props.moveColumn(this.props.selected_column,t)}get option_dict(){return{"Shift Left":this._shift_column_left,"Shift Right":this._shift_column_right,Hide:this.props.hideColumn,"Hide in All Docs":this.props.hideInAll,"Unhide All":this.props.unhideAllColumns,"Add Column":()=>this.props.addColumn(!1),"Add Column In All Docs":()=>this.props.addColumn(!0)}}get icon_dict(){return{"Shift Left":"direction-left","Shift Right":"direction-right",Hide:"eye-off","Hide in All Docs":"eye-off","Unhide All":"eye-on","Add Column":"add-column-right","Add Column In All Docs":"add-column-right"}}render(){return React.createElement(r,{menu_name:"Column",option_dict:this.option_dict,icon_dict:this.icon_dict,disabled_items:this.props.disabled_items,hidden_items:[]})}}c.propTypes={moveColumn:PropTypes.func,table_spec:PropTypes.object,filtered_column_names:PropTypes.array,selected_column:PropTypes.string,hideColumn:PropTypes.func,hideInAll:PropTypes.func,unhideAllColumns:PropTypes.func,addColumn:PropTypes.func,disabled_items:PropTypes.array};class p extends React.Component{constructor(e){super(e),doBinding(this)}_shift_column_left(){let e=this.props.table_spec.column_names.indexOf(this.props.selected_column);if(0==e)return;let t=this.props.table_spec.column_names[e-1];this._moveColumn(this.props.selected_column,t)}_shift_column_right(){let e=this.props.table_spec.column_names.indexOf(this.props.selected_column);if(e==this.props.table_spec.column_names.length-1)return;let t=this.props.table_spec.column_names[e+2];this._moveColumn(this.props.selected_column,t)}get option_dict(){let e={};return e[this.props.table_is_shrunk?"Maximize Table":"Minimize Table"]=this.props.toggleTableShrink,e["Show Error Drawer"]=this.props.openErrorDrawer,e}get icon_dict(){let e={};return e[this.props.table_is_shrunk?"Maximize Table":"Minimize Table"]=this.props.table_is_shrunk?"maximize":"minimize",e["Show Error Drawer"]="panel-stats",e}render(){return React.createElement(r,{menu_name:"View",option_dict:this.option_dict,icon_dict:this.icon_dict,disabled_items:[],disable_all:this.props.disable_all,hidden_items:[]})}}p.propTypes={table_is_shrunk:PropTypes.bool,toggleTableShrink:PropTypes.func,openErrorDrawer:PropTypes.func}},,function(e,t,s){"use strict";s.d(t,"b",(function(){return _})),s.d(t,"a",(function(){return p}));var i=s(5),o=blueprint;let n=$SCRIPT_ROOT+"/library",a=$SCRIPT_ROOT+"/repository",r=$SCRIPT_ROOT+"/account_info",l=$SCRIPT_ROOT+"/login";const c=10;class p extends React.Component{constructor(e){super(e),doBinding(this),this.lg_ref=React.createRef(),this.state={usable_width:window.innerWidth-2*c,old_left_width:0},this.overflow_items=[]}componentDidMount(){window.addEventListener("resize",this._update_window_dimensions),this._update_window_dimensions(),this.setState({old_left_width:this._getLeftWidth()})}componentDidUpdate(){let e=this._getLeftWidth();e!=this.state.old_left_width&&this.setState({old_left_width:e})}_update_window_dimensions(){this.setState({usable_width:window.innerWidth-2*c})}handle_signout(){doSignOut(window.page_id)}getIntent(e){return this.props.selected==e?"primary":null}renderNav(e){return React.createElement(o.Button,{icon:e.icon,key:e.text,minimal:!0,text:e.text,intent:e.intent,onClick:e.onClick})}_getLeftWidth(){return this.lg_ref&&this.lg_ref.current?this.lg_ref.current.getBoundingClientRect().width:null}_getRightWidth(){let e=this._getLeftWidth();return e?this.state.usable_width-e-35:.25*this.state.usable_width-35}_authenticatedItems(){return[{icon:"home",text:"Library",intent:this.getIntent("library"),onClick:()=>{window.open(n)}},{icon:"database",text:"Repository",intent:this.getIntent("repository"),onClick:()=>{window.open(a)}},{icon:"settings",text:this.props.user_name,intent:this.getIntent("account"),onClick:()=>{window.open(r)}},{icon:"log-out",text:"Logout",intent:this.getIntent("logout"),onClick:this.handle_signout}]}_notAuthenticatedItems(){return[{icon:"log-in",text:"Login",intent:this.getIntent("login"),onClick:()=>{window.open(l)}}]}_onOverflow(e){this.overflow_items=e}_overflowRenderer(){let e={},t={};for(let s of this.overflow_items)e[s.text]=s.onClick,t[s.text]=s.icon;return React.createElement(i.b,{alt_button:()=>React.createElement("span",{className:"bp3-breadcrumbs-collapsed",style:{marginTop:5}}),option_dict:e,icon_dict:t})}render(){this.props.menus;let e=[];this.props.show_api_links&&(e=[{icon:"code-block",text:"Api",intent:null,onClick:()=>{window.open("https://tactic.readthedocs.io/en/latest/Tile-Commands.html")}},{icon:"code-block",text:"ObjApi",intent:null,onClick:()=>{window.open("https://tactic.readthedocs.io/en/latest/Object-Oriented-API.html")}}]),e.push({icon:"manual",text:"Docs",intent:null,onClick:()=>{window.open("http://tactic.readthedocs.io/en/latest/index.html")}}),e=this.props.is_authenticated?e.concat(this._authenticatedItems()):e.concat(this._notAuthenticatedItems());let t={width:this._getRightWidth(),justifyContent:"flex-end"};return React.createElement(o.Navbar,{style:{paddingLeft:10}},React.createElement("div",{className:"bp3-navbar-group bp3-align-left",ref:this.lg_ref},React.createElement(o.Navbar.Heading,{className:"d-flex align-items-center"},React.createElement("img",{className:"mr-2",src:window.tactic_img_url,alt:"",width:"32 ",height:"32"}),"Tactic"),null!=this.props.menus&&React.createElement(React.Fragment,null,this.props.menus)),React.createElement(o.Navbar.Group,{align:o.Alignment.RIGHT,style:t},React.createElement(o.NavbarDivider,null),React.createElement(o.OverflowList,{items:e,overflowRenderer:this._overflowRenderer,visibleItemRenderer:this.renderNav,onOverflow:this._onOverflow})))}}function _(e=null,t=!1){let s=document.querySelector("#navbar-root");ReactDOM.render(React.createElement(p,{is_authenticated:window.is_authenticated,selected:e,show_api_links:t,user_name:window.username}),s)}p.propTypes={is_authenticated:PropTypes.bool,img_url:PropTypes.string,user_name:PropTypes.string,menus:PropTypes.object,selected:PropTypes.string,show_api_links:PropTypes.bool},p.defaultProps={menus:null,selected:null,show_api_links:!1}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i extends React.Component{constructor(e){super(e),doBinding(this),this.mousetrap=null}componentDidMount(){this.initializeMousetrap()}componentWillUnmount(){this.mousetrap.reset(),this.mousetrap=null}initializeMousetrap(){if(this.mousetrap&&this.mousetrap.reset(),this.props.target_ref||this.props.global){this.props.global?this.mousetrap=new Mousetrap:this.mousetrap=new Mousetrap(this.props.target_ref);for(let e of this.props.bindings)this.mousetrap.bind(e[0],e[1])}else this.mousetrap=null}componentDidUpdate(){this.mousetrap||this.initializeMousetrap()}render(){return React.createElement("div",null)}}i.propTypes={target_ref:PropTypes.object,bindings:PropTypes.array,global:PropTypes.bool},i.defaultProps={global:!1}},function(e,t,s){"use strict";s.d(t,"c",(function(){return r})),s.d(t,"d",(function(){return l})),s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return a}));const i=20;var o=blueprint;let n=window.react_draggable.DraggableCore;class a extends React.Component{constructor(e){super(e),doBinding(this),this.startX=null,this.startY=null,this.lastX=null,this.lastY=null}get icon_dict(){return{x:"drag-handle-vertical",y:"drag-handle-horizontal",both:"caret-right"}}_dragStart(e,t){this.startX=this.getMouseX(e),this.startY=this.getMouseY(e),this.lastX=this.startX,this.lastY=this.startY,this.props.dragStart&&this.props.dragStart(e,t,this.startX,this.startY),e.preventDefault()}_onDrag(e,t){this.lastX=this.getMouseX(e),this.lastY=this.getMouseY(e);let s=this.lastX-this.startX,i=this.lastY-this.startY;this.props.onDrag&&this.props.onDrag(e,t,this.lastX,this.lastY,s,i),e.preventDefault()}_dragEnd(e,t){let s=this.getMouseX(e);s&&(this.lastX=s);let i=this.getMouseY(e);i&&(this.lastY=i);let o=this.lastX-this.startX,n=this.lastY-this.startY;this.props.dragEnd&&this.props.dragEnd(e,t,this.lastX,this.lastY,o,n),e.preventDefault()}getMouseX(e){return"touchend"==e.type?null:"touchmove"==e.type||"touchstart"==e.type?e.touches[0].clientX:e.clientX}getMouseY(e){return"touchend"==e.type?null:"touchmove"==e.type||"touchstart"==e.type?e.touches[0].clientY:e.clientY}get cursor_dict(){return{x:"ew-resize",y:"ns-resize",both:"se-resize"}}render(){let e=this.props.position_dict;return e.cursor=this.cursor_dict[this.props.direction],"both"==this.props.direction&&(e.transform="rotate(45deg)"),React.createElement(n,{onStart:this._dragStart,onStop:this._dragEnd,onDrag:this._onDrag,grid:[5,5],scale:1},React.createElement(o.Icon,{icon:this.icon_dict[this.props.direction],iconSize:this.props.iconSize,style:e}))}}a.propTypes={position_dict:PropTypes.object,onDrag:PropTypes.func,dragStart:PropTypes.func,dragEnd:PropTypes.func,direction:PropTypes.string,iconSize:PropTypes.number},a.defaultProps={direction:"x",iconSize:20,onDrag:null,dragStart:null,dragEnd:null};class r extends React.Component{constructor(e){super(e),doBinding(this),this.left_pane_ref=React.createRef(),this.right_pane_ref=React.createRef(),this.drag_handle_ref=React.createRef(),this.scroll_bases={},this.top_ref=null==this.props.top_ref?React.createRef():this.props.top_ref,this.old_left_width=0,this.old_right_width=0,this.unique_id=guid(),this.state={current_width_fraction:this.props.initial_width_fraction,mounted:!1,deltaPosition:{x:0,y:0}}}componentDidMount(){window.addEventListener("resize",this.resize_to_window),this.setState({mounted:!0},()=>{this.props.handleSplitUpdate&&this.props.handleSplitUpdate(this.left_width,this.right_width,this.state.current_width_fraction)})}componentDidUpdate(){this.notifySplitUpate()}get left_width(){return this.props.show_handle?(this.props.available_width-i)*this.state.current_width_fraction:this.props.available_width*this.state.current_width_fraction}get right_width(){return this.props.show_handle?(1-this.state.current_width_fraction)*(this.props.available_width-i):(1-this.state.current_width_fraction)*this.props.available_width}update_width_fraction(e){this.setState({current_width_fraction:e})}get width_has_changed(){return this.left_width!=this.old_left_width||this.right_width!=this.old_right_width}notifySplitUpate(){this.width_has_changed&&null!=this.props.handleSplitUpdate&&(this.old_left_width=this.left_width,this.old_right_width=this.right_width,this.props.handleSplitUpdate(this.left_width,this.right_width,this.state.current_width_fraction))}_handleDrag(e,t,s,i,o,n){let a=(s-this.left_pane_ref.current.offsetLeft)/this.props.available_width;this.update_width_fraction(a),this._resetScrolls()}_getSelectorElements(){let e={};if(this.props.scrollAdjustSelectors&&this.top_ref&&this.top_ref.current)for(let t of this.props.scrollAdjustSelectors){let s=$(this.top_ref.current).find(t);s.length>0&&(e[t]=s[0])}return e}_resetScrolls(){let e=this._getSelectorElements();for(let t in e){let s=e[t];s.scrollLeft=this.scroll_bases[t].left,s.scrollTop=this.scroll_bases[t].top}}_handleDragStart(e,t,s,i,o,n){let a=this._getSelectorElements();for(let e in a){let t=a[e];this.scroll_bases[e]={left:t.scrollLeft,top:t.scrollTop}}this.props.handleResizeStart&&this.props.handleResizeStart(e,t,s,i,o,n)}_handleDragEnd(e,t,s,i,o,n){let a=(s-this.left_pane_ref.current.offsetLeft)/this.props.available_width;this.props.handleResizeEnd&&this.props.handleResizeEnd(a),this._resetScrolls()}render(){let e={width:this.left_width,height:this.props.available_height-this.props.bottom_margin,flexDirection:"column",overflow:"hidden"},t={width:this.right_width,height:this.props.available_height-this.props.bottom_margin,flexDirection:"column",overflowY:this.props.right_pane_overflow},s=(this.props.hide_me,{position:"relative",left:0,top:(this.props.available_height-this.props.bottom_margin)/2});return React.createElement("div",{id:this.unique_id,className:"d-flex flex-row horizontal-panes",ref:this.top_ref},React.createElement("div",{ref:this.left_pane_ref,style:e,className:"res-viewer-resizer"},this.props.left_pane),this.props.show_handle&&React.createElement(a,{position_dict:s,onDrag:this._handleDrag,dragStart:this._handleDragStart,dragEnd:this._handleDragEnd,direction:"x",iconSize:this.props.dragIconSize}),React.createElement("div",{ref:this.right_pane_ref,style:t},this.props.right_pane))}}r.propTypes={available_width:PropTypes.number,available_height:PropTypes.number,left_pane:PropTypes.object,right_pane:PropTypes.object,right_pane_overflow:PropTypes.string,scrollAdjustSelectors:PropTypes.array,handleSplitUpdate:PropTypes.func,handleResizeStart:PropTypes.func,handleResizeEnd:PropTypes.func,initial_width_fraction:PropTypes.number,top_ref:PropTypes.object,bottom_margin:PropTypes.number,show_handle:PropTypes.bool,dragIconSize:PropTypes.number},r.defaultProps={handleSplitUpdate:null,handleResizeStart:null,handleResizeEnd:null,scrollAdjustSelectors:null,initial_width_fraction:.5,hide_me:!1,left_margin:null,right_margin:null,right_pane_overflow:"visible",top_ref:null,bottom_margin:0,show_handle:!0,dragIconSize:20};class l extends React.Component{constructor(e){super(e),doBinding(this),this.top_ref=React.createRef(),this.top_pane_ref=React.createRef(),this.bottom_pane_ref=React.createRef(),this.scroll_bases={},this.old_bottom_height=0,this.old_top_height=0,this.unique_id=guid(),this.state=this.state={current_height_fraction:this.props.initial_height_fraction,mounted:!1}}componentDidMount(){this.setState({mounted:!0}),window.addEventListener("resize",this.resize_to_window)}componentDidUpdate(){this.notifySplitUpate()}get top_height(){return this.props.available_height*this.state.current_height_fraction}get bottom_height(){return(1-this.state.current_height_fraction)*this.props.available_height}notifySplitUpate(){null!=this.props.handleSplitUpdate&&this.height_has_changed&&(this.old_top_height=this.top_height,this.old_bottom_height=this.bottom_height,this.props.handleSplitUpdate(this.top_height,this.bottom_height,this.state.current_height_fraction))}update_height_fraction(e){this.setState({current_height_fraction:e})}get height_has_changed(){return this.top_height!=this.old_top_height||this.bottom_height!=this.old_bottom_height}_handleDrag(e,t,s,i,o,n){let a=(i-this.top_pane_ref.current.offsetTop)/this.props.available_height;this.update_height_fraction(a)}_getSelectorElements(){let e={};if(this.props.scrollAdjustSelectors&&this.top_ref&&this.top_ref.current)for(let t of this.props.scrollAdjustSelectors){let s=$(this.top_ref.current).find(t);s.length>0&&(e[t]=s[0])}return e}_resetScrolls(){let e=this._getSelectorElements();for(let t in e){let s=e[t];s.scrollLeft=this.scroll_bases[t].left,s.scrollTop=this.scroll_bases[t].top}}_handleDragStart(e,t,s,i,o,n){let a=this._getSelectorElements();for(let e in a){let t=a[e];this.scroll_bases[e]={left:t.scrollLeft,top:t.scrollTop}}this.props.handleResizeStart&&this.props.handleResizeStart(e,t,s,i,o,n)}_handleDragEnd(e,t,s,i,o,n){let a=(i-this.top_pane_ref.current.offsetTop)/this.props.available_height;this.props.handleResizeEnd&&this.props.handleResizeEnd(a),this._resetScrolls()}render(){let e={width:this.props.available_width,height:this.top_height,overflowY:this.props.overflow};this.props.hide_top&&(e.display="none");let t={width:this.props.available_width,height:this.bottom_height,overflowY:this.props.overflow},s={position:"relative",left:this.props.available_width/2,top:0};return React.createElement("div",{id:this.unique_id,className:"d-flex flex-column",ref:this.top_ref},React.createElement("div",{ref:this.top_pane_ref,style:e},this.props.top_pane),this.props.show_handle&&React.createElement(a,{position_dict:s,onDrag:this._handleDrag,direction:"y",iconSize:this.props.dragIconSize,dragStart:this._handleDragStart,dragEnd:this._handleDragEnd}),React.createElement("div",{ref:this.bottom_pane_ref,style:t},this.props.bottom_pane))}}l.propTypes={available_width:PropTypes.number,available_height:PropTypes.number,top_pane:PropTypes.object,hide_top:PropTypes.bool,bottom_pane:PropTypes.object,handleSplitUpdate:PropTypes.func,handleResizeStart:PropTypes.func,handleResizeEnd:PropTypes.func,scrollAdjustSelectors:PropTypes.array,initial_height_fraction:PropTypes.number,overflow:PropTypes.string,show_handle:PropTypes.bool,dragIconSize:PropTypes.number},l.defaultProps={handleSplitUpdate:null,handleResizeStart:null,handleResizeEnd:null,scrollAdjustSelectors:null,initial_height_fraction:.5,hide_top:!1,overflow:"scroll",show_handle:!0,dragIconSize:20}},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s(1);class o{constructor(e,t){this.name_space=e,this.recInterval=null,this.retry_interval=t,this.connectme(),this.initialize_socket_stuff(),this.watchForDisconnect()}connectme(){use_ssl?this.socket=io.connect(`https://${document.domain}:${location.port}/${this.name_space}`):this.socket=io.connect(`http://${document.domain}:${location.port}/${this.name_space}`)}initialize_socket_stuff(){}watchForDisconnect(){let e=this;this.socket.on("disconnect",(function(){Object(i.b)({message:"lost server connection"}),e.socket.close(),e.recInterval=setInterval((function(){e.attemptReconnect()}),e.retry_interval)}))}attemptReconnect(){this.socket.connected?(clearInterval(this.recInterval),this.initialize_socket_stuff(),this.watchForDisconnect(),Object(i.b)({message:"reconnected to server"})):this.connectme()}}},,function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s(1),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},n=blueprint;function a(e,t=null,s=null,i="right",n="30%"){return class extends React.Component{constructor(e){super(e),doBinding(this),this.tsocket=t,this.state={show_drawer:!1,contents:[],error_drawer_size:n,position:i}}componentDidMount(){this.tsocket&&(this.tsocket.socket.on("close-error-drawer",this._close),this.tsocket.socket.on("open-error-drawer",this._open),this.tsocket.socket.on("add-error-drawer-entry",this._addEntry),this.tsocket.socket.on("clear-error-drawer",this._clearAll))}_close(){this.setState({show_drawer:!1})}_open(){this.setState({show_drawer:!0})}_toggle(){this.setState({show_drawer:!this.state.show_drawer})}_addEntry(e,t=!0){this.setState({contents:[...this.state.contents,e],show_drawer:t})}_clearAll(){this.setState({contents:[]})}_onClose(){this.setState({show_drawer:!1})}render(){let t={openErrorDrawer:this._open,closeErrorDrawer:this._close,clearErrorDrawer:this._clearAll,addErrorDrawerEntry:this._addEntry,toggleErrorDrawer:this._toggle};return React.createElement(React.Fragment,null,React.createElement(e,o({},this.props,t,{errorDrawerFuncs:t})),React.createElement(r,o({},this.state,{title:"Error Drawer",size:this.state.error_drawer_size,onClose:this._onClose,clearAll:this._clearAll})))}}}class r extends React.Component{render(){let e=this.props.contents.map((e,t)=>{let s={__html:e.content};return React.createElement(n.Card,{key:t,interactive:!0,elevation:n.Elevation.TWO,style:{marginBottom:5}},e.title&&React.createElement("h6",null,React.createElement("a",{href:"#"},e.title)),React.createElement("div",{style:{fontSize:12},dangerouslySetInnerHTML:s}))});return React.createElement(n.Drawer,{icon:"console",title:this.props.title,isOpen:this.props.show_drawer,position:this.props.position,canOutsideClickClose:!0,onClose:this.props.onClose,size:this.props.size},React.createElement("div",{className:n.Classes.DRAWER_BODY},React.createElement("div",{className:"d-flex flex-row justify-content-around mt-2"},React.createElement(n.Button,{text:"Clear All",onClick:this.props.clearAll})),React.createElement("div",{className:n.Classes.DIALOG_BODY},e)))}}i.a.propTypes={show_drawer:PropTypes.bool,contents:PropTypes.array,title:PropTypes.string,onClose:PropTypes.func,position:PropTypes.string,clearAll:PropTypes.func,size:PropTypes.oneOfType([PropTypes.string,PropTypes.number])},i.a.defaultProps={show_drawer:!1,contents:[],position:"right",title:null,size:"30%"}},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s(0);class o extends React.Component{constructor(e){super(e),this.props.code_container_ref?this.code_container_ref=this.props.code_container_ref:this.code_container_ref=React.createRef(),this.handleChange=this.handleChange.bind(this),this.mousetrap=new Mousetrap,this.create_api()}createCMArea(e,t=1){let s=CodeMirror(e,{lineNumbers:!0,matchBrackets:!0,highlightSelectionMatches:!0,autoCloseBrackets:!0,indentUnit:4,mode:this.props.mode,readOnly:this.props.readOnly});1!=t&&s.setOption("firstLineNumber",t);let i=Object.assign(this.props.extraKeys,{Tab:function(e){let t=new Array(5).join(" ");e.replaceSelection(t)},"Ctrl-Space":"autocomplete"});return s.setOption("extraKeys",i),s.setSize(null,"100%"),s.on("change",this.handleChange),s}handleChange(e,t){this.props.handleChange(e.getDoc().getValue())}componentDidMount(){this.cmobject=this.createCMArea(this.code_container_ref.current,this.props.first_line_number),this.cmobject.setValue(this.props.code_content),this.create_keymap(),null!=this.props.setCMObject&&this.props.setCMObject(this.cmobject)}componentDidUpdate(){this.props.sync_to_prop&&this.cmobject.setValue(this.props.code_content),1!=this.props.first_line_number&&this.cmobject.setOption("firstLineNumber",this.props.first_line_number),this.cmobject.refresh()}searchCM(){CodeMirror.commands.find(this.cmobject)}clearSelections(){CodeMirror.commands.clearSearch(this.cmobject),CodeMirror.commands.singleSelection(this.cmobject)}create_api(){let e=this;Object(i.b)("get_api_dict",{},(function(t){e.api_dict_by_category=t.api_dict_by_category,e.api_dict_by_name=t.api_dict_by_name,e.ordered_api_categories=t.ordered_api_categories,e.api_list=[];for(let t of e.ordered_api_categories)for(let s of e.api_dict_by_category[t])e.api_list.push(s.name);CodeMirror.commands.autocomplete=function(t){t.showHint({hint:CodeMirror.hint.anyword,api_list:e.api_list,extra_autocomplete_list:e.extra_autocomplete_list})}}))}create_keymap(){let e=this;CodeMirror.keyMap.default.Esc=function(){e.clearSelections()};let t=CodeMirror.keyMap.default.hasOwnProperty("Cmd-S");this.mousetrap.bind(["escape"],(function(t){e.clearSelections(),t.preventDefault()})),t?(CodeMirror.keyMap.default["Cmd-S"]=function(){e.props.saveMe()},this.mousetrap.bind(["command+l"],(function(e){e.preventDefault()})),this.mousetrap.bind(["command+f"],(function(t){e.searchCM(),t.preventDefault()}))):(CodeMirror.keyMap.default["Ctrl-S"]=function(){e.props.saveMe()},this.mousetrap.bind(["ctrl+l"],(function(e){e.preventDefault()})),this.mousetrap.bind(["ctrl+f"],(function(t){e.searchCM(),t.preventDefault()})))}render(){let e={height:this.props.code_container_height,width:"100%",lineHeight:"21px"};return React.createElement("div",{id:"code-container",style:e,ref:this.code_container_ref})}}o.propTypes={handleChange:PropTypes.func,code_content:PropTypes.string,sync_to_prop:PropTypes.bool,mode:PropTypes.string,saveMe:PropTypes.func,readOnly:PropTypes.bool,first_line_number:PropTypes.number,extraKeys:PropTypes.object,setCMObject:PropTypes.func,code_container_ref:PropTypes.object,code_container_height:PropTypes.oneOfType([PropTypes.string,PropTypes.number])},o.defaultProps={first_line_number:1,code_container_height:"100%",sync_to_prop:!1,mode:"python",readOnly:!1,extraKeys:{},setCMObject:null,code_container_ref:null}},,,,,function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e};let o=window.react_sortable_hoc;class n extends React.Component{constructor(e){super(e),doBinding(this),this.state={mounted:!1},this.container_ref=null==this.props.container_ref?React.createRef():this.props.container_ref}get sorter_exists(){return $(this.container_ref.current).hasClass("ui-sortable")}componentDidMount(){this.setState({mounted:!0})}render(){let e=this.props.ElementComponent;return React.createElement("div",{id:this.props.id,style:this.props.style,ref:this.container_ref},this.props.item_list.length>0&&this.props.item_list.map((t,s)=>React.createElement(e,i({key:t[this.props.key_field_name],index:s},this.props,t))))}}n.propTypes={id:PropTypes.string,handle:PropTypes.string,key_field_name:PropTypes.string,ElementComponent:PropTypes.func,item_list:PropTypes.array,style:PropTypes.object,container_ref:PropTypes.object,resortFunction:PropTypes.func},n.defaultProps={container_ref:null};let a=o.sortableContainer(n)},function(e,t,s){"use strict";s.d(t,"a",(function(){return _}));var i=s(3),o=s(13),n=s(18),a=s(8),r=s(0),l=s(1);let c=blueprint,p=window.react_sortable_hoc;class _ extends React.Component{constructor(e){super(e),doBinding(this),this.header_ref=React.createRef(),this.body_ref=React.createRef(),this.state={console_item_with_focus:null,console_error_log_text:"",show_console_error_log:!1},this.pseudo_tile_id=null}componentDidMount(){this.setState({mounted:!0}),this.props.tsocket.socket.off("console-message"),this.props.tsocket.socket.on("console-message",this._handleConsoleMessage)}_createTextEntry(e,t){return{unique_id:e,type:"text",am_shrunk:!1,summary_text:t,console_text:"",show_markdown:!1}}addConsoleText(e){Object(r.f)("host","print_text_area_to_console",{console_text:e,user_id:window.user_id,main_id:window.main_id},(function(e){e.success||Object(l.b)(e)}))}_addBlankText(){this.addConsoleText("")}_addBlankCode(e){this._addCodeArea(""),e.preventDefault()}_addCodeArea(e){Object(r.f)("host","print_code_area_to_console",{console_text:e,user_id:window.user_id,main_id:window.main_id},(function(e){e.success||Object(l.b)(e)}))}_resetConsole(){let e=[];for(let t of this.props.console_items)if("code"!=t.type)e.push(t);else{let s=Object.assign({},t);s.output_text="",s.execution_count=0,e.push(s)}this.props.setMainStateValue("console_items",e),Object(r.f)(window.main_id,"clear_console_namespace",{})}_clearConsole(){this.props.setMainStateValue("console_items",[])}_toggleConsoleLog(){let e=this;this.state.show_console_error_log?this.setState({show_console_error_log:!1}):null==e.pseudo_tile_id?Object(r.f)(window.main_id,"get_pseudo_tile_id",{},(function(t){e.pseudo_tile_id=t.pseudo_tile_id,null==e.pseudo_tile_id?e.setState({console_error_log_text:"pseudo-tile is initializing..."},()=>{this.setState({show_console_error_log:!0})}):Object(r.f)("host","get_container_log",{container_id:e.pseudo_tile_id},(function(t){let s=t.log_text;""==s&&(s="Got empty result. The pseudo-tile is probably starting up."),e.setState({console_error_log_text:s},()=>{e.setState({show_console_error_log:!0})})}))})):Object(r.f)("host","get_container_log",{container_id:e.pseudo_tile_id},(function(t){e.setState({console_error_log_text:t.log_text},()=>{e.setState({show_console_error_log:!0})})}))}_toggleMainLog(){let e=this;this.state.show_console_error_log?this.setState({show_console_error_log:!1}):Object(r.f)("host","get_container_log",{container_id:window.main_id},(function(t){e.setState({console_error_log_text:t.log_text},()=>{e.setState({show_console_error_log:!0})})}))}_setFocusedItem(e){this.setState({console_item_with_focus:e})}_zoomConsole(){this.props.setMainStateValue("console_is_zoomed",!0)}_unzoomConsole(){this.props.setMainStateValue("console_is_zoomed",!1)}_expandConsole(){this.props.setMainStateValue("console_is_shrunk",!1)}_shrinkConsole(){this.props.setMainStateValue("console_is_shrunk",!0)}_toggleExports(){this.props.setMainStateValue("show_exports_pane",!this.props.show_exports_pane)}_setConsoleItemValue(e,t,s){let i=this.get_console_item_entry(e);i[t]=s,this.replace_console_item_entry(e,i)}replace_console_item_entry(e,t){let s=[...this.props.console_items],i=this._consoleItemIndex(e);s.splice(i,1,t),this.props.setMainStateValue("console_items",s)}get_console_item_entry(e){return Object.assign({},this.props.console_items[this._consoleItemIndex(e)])}_consoleItemIndex(e){let t=0;for(let s of this.props.console_items){if(s.unique_id==e)return t;++t}return-1}_resortConsoleItems({oldIndex:e,newIndex:t}){let s=[...this.props.console_items],i=arrayMove(s,e,t);this.props.setMainStateValue("console_items",i)}_goToNextCell(e){let t=this._consoleItemIndex(e)+1;if(t==this.props.console_items.length)return;let s=this.props.console_items[t].unique_id;this._setConsoleItemValue(s,"set_focus",!0)}_closeConsoleItem(e){let t=this._consoleItemIndex(e),s=[...this.props.console_items];s.splice(t,1),this.props.setMainStateValue("console_items",s)}_addConsoleEntry(e,t=!0,s=!1){let i;e.set_focus=s,i=null==this.state.console_item_with_focus?this.props.console_items.length:this._consoleItemIndex(this.state.console_item_with_focus)+1;let o=[...this.props.console_items];o.splice(i,0,e),this.props.setMainStateValue("console_items",o),t&&this.props.setMainStateValue("console_is_shrunk",!1)}_stopConsoleSpinner(e){let t=this.get_console_item_entry(e.console_id);t.show_spinner=!1,t.execution_count=e.execution_count,this.replace_console_item_entry(e.console_id,t)}_appendConsoleItemOutput(e){let t=this.get_console_item_entry(e.console_id).output_text;""!=t&&(t+="<br>"),this._setConsoleItemValue(e.console_id,"output_text",t+e.message)}_handleConsoleMessage(e){let t=this;({consoleLog:e=>t._addConsoleEntry(e.message,e.force_open),stopConsoleSpinner:this._stopConsoleSpinner,consoleCodePrint:this._appendConsoleItemOutput})[e.console_message](e)}_bodyHeight(){return this.state.mounted?this.props.console_available_height-$(this.header_ref.current).outerHeight():this.props.console_available_height-75}render(){let e={marginLeft:1,marginTop:1},t=this.props.console_is_shrunk?"am-shrunk":"not-shrunk";return this.props.console_is_zoomed&&(t="am-zoomed"),React.createElement(c.Card,{id:"console-panel",className:t,elevation:2,style:this.props.style},React.createElement("div",{className:"d-flex flex-column justify-content-around"},React.createElement("div",{id:"console-heading",ref:this.header_ref,className:"d-flex flex-row justify-content-between"},React.createElement("div",{id:"console-header-left",className:"d-flex flex-row"},this.props.console_is_shrunk&&this.props.shrinkable&&React.createElement(i.b,{handleClick:this._expandConsole,style:{marginLeft:2},icon:"chevron-right"}),!this.props.console_is_shrunk&&this.props.shrinkable&&React.createElement(i.b,{handleClick:this._shrinkConsole,style:{marginLeft:2},icon:"chevron-down"}),this.props.shrinkable&&React.createElement("b",{style:{alignSelf:"center",marginRight:5}},"Log"),React.createElement(i.b,{extra_glyph_text:"text",style:e,intent:"primary",tooltip:"Add new text area",handleClick:this._addBlankText,icon:"new-text-box"}),React.createElement(i.b,{extra_glyph_text:"code",handleClick:this._addBlankCode,tooltip:"Add new code area",intent:"primary",style:e,icon:"code"}),React.createElement(i.b,{handleClick:this._resetConsole,style:e,tooltip:"Clear all output and reset namespace",intent:"warning",extra_glyph_text:"reset",icon:"reset"}),React.createElement(i.b,{extra_glyph_text:"clear",style:e,tooltip:"Totally erase everything",handleClick:this._clearConsole,intent:"danger",icon:"trash"}),React.createElement(i.b,{extra_glyph_text:"log",style:e,tooltip:"Show container log for the log",handleClick:this._toggleConsoleLog,icon:"console"}),React.createElement(i.b,{extra_glyph_text:"main",tooltip:"Show container log for the main project container",style:e,handleClick:this._toggleMainLog,icon:"console"})),React.createElement("div",{id:"console-header-right",className:"d-flex flex-row"},this.props.zoomable&&React.createElement(c.Button,{onClick:this._toggleExports,style:{marginRight:5},minimal:!0,small:!0,text:"exports"}),!this.props.console_is_zoomed&&this.props.zoomable&&React.createElement(i.b,{handleClick:this._zoomConsole,icon:"maximize"}),this.props.console_is_zoomed&&this.props.zoomable&&React.createElement(i.b,{handleClick:this._unzoomConsole,icon:"minimize"})))),!this.props.console_is_shrunk&&React.createElement("div",{id:"console",ref:this.body_ref,style:{height:this._bodyHeight(),backgroundColor:"white"}},this.state.show_console_error_log&&React.createElement("pre",null,this.state.console_error_log_text),!this.state.show_console_error_log&&React.createElement(n.a,{id:"console-items-div",ElementComponent:d,key_field_name:"unique_id",item_list:this.props.console_items,handle:".console-sorter",onSortStart:(e,t)=>t.preventDefault(),onSortEnd:this._resortConsoleItems,setConsoleItemValue:this._setConsoleItemValue,execution_count:0,handleDelete:this._closeConsoleItem,goToNextCell:this._goToNextCell,setFocus:this._setFocusedItem,addNewTextItem:this._addBlankText,addNewCodeItem:this._addBlankCode,useDragHandle:!0,axis:"y"})))}}_.propTypes={console_items:PropTypes.array,console_is_shrunk:PropTypes.bool,show_exports_pane:PropTypes.bool,setMainStateValue:PropTypes.func,console_available_height:PropTypes.number,tsocket:PropTypes.object,style:PropTypes.object,shrinkable:PropTypes.bool,zoomable:PropTypes.bool},_.defaultProps={style:{},shrinkable:!0,zoomable:!0};const h=p.sortableHandle(class extends React.Component{render(){return React.createElement(c.Icon,{icon:"drag-handle-vertical",style:{marginLeft:0,marginRight:6},iconSize:20,className:"console-sorter"})}});const d=p.sortableElement(class extends React.Component{render(){return"text"==this.props.type?React.createElement(g,this.props):"code"==this.props.type?React.createElement(m,this.props):"fixed"==this.props.type?React.createElement(u,this.props):void 0}});class u extends React.Component{constructor(e){super(e),this.ce_summary0ref=React.createRef(),doBinding(this)}componentDidMount(){this.executeEmbeddedScripts(),this.makeTablesSortable()}componentDidUpdate(){this.executeEmbeddedScripts(),this.makeTablesSortable()}_toggleShrink(){this.props.setConsoleItemValue(this.props.unique_id,"am_shrunk",!this.props.am_shrunk)}_deleteMe(){this.props.handleDelete(this.props.unique_id)}_handleSummaryTextChange(e){this.props.setConsoleItemValue(this.props.unique_id,"summary_text",e)}executeEmbeddedScripts(){let e=$("#"+this.props.unique_id+" .log-panel-body script").toArray();for(let t of e)try{window.eval(t.text)}catch(e){}}makeTablesSortable(){let e=$("#"+this.props.unique_id+" table.sortable").toArray();for(let t of e)sorttable.makeSortable(t)}render(){let e={__html:this.props.console_text},t=this.props.am_shrunk?"log-panel log-panel-invisible fixed-log-panel":"log-panel log-panel-visible fixed-log-panel";return this.props.is_error&&(t+=" error-log-panel"),React.createElement("div",{className:t+" d-flex flex-row",id:this.props.unique_id,style:{marginBottom:10}},React.createElement("div",{className:"button-div shrink-expand-div d-flex flex-row"},React.createElement(h,null),!this.props.am_shrunk&&React.createElement(i.b,{icon:"chevron-down",handleClick:this._toggleShrink}),this.props.am_shrunk&&React.createElement(i.b,{icon:"chevron-right",handleClick:this._toggleShrink})),this.props.am_shrunk&&React.createElement(c.EditableText,{value:this.props.summary_text,onChange:this._handleSummaryTextChange,className:"log-panel-summary"}),!this.props.am_shrunk&&React.createElement("div",{className:"d-flex flex-column",style:{width:"100%"}},React.createElement("div",{className:"log-panel-body d-flex flex-row"},React.createElement("div",{style:{marginTop:10,marginLeft:30,padding:8,width:"100%",border:"1px solid #c7c7c7"},dangerouslySetInnerHTML:e}),React.createElement("div",{className:"button-div d-flex flex-row"},React.createElement(i.b,{handleClick:this._deleteMe,tooltip:"Delete this item",style:{marginLeft:10,marginRight:66},intent:"danger",icon:"trash"})))))}}u.propTypes={unique_id:PropTypes.string,is_error:PropTypes.bool,am_shrunk:PropTypes.bool,summary_text:PropTypes.string,console_text:PropTypes.string,setConsoleItemValue:PropTypes.func,handleDelete:PropTypes.func};class m extends React.Component{constructor(e){super(e),doBinding(this),this.cmobject=null}componentDidMount(){this.props.set_focus&&(null!=this.cmobject&&(this.cmobject.focus(),this.cm_object.setCursor({line:0,ch:0})),this.props.setConsoleItemValue(this.props.unique_id,"set_focus",!1));let e=this;null!=this.cmobject&&(this.cmobject.on("focus",()=>{e.props.setFocus(this.props.unique_id)}),this.cmobject.on("blur",()=>{e.props.setFocus(null)})),this.executeEmbeddedScripts(),this.makeTablesSortable()}componentDidUpdate(){this.executeEmbeddedScripts(),this.makeTablesSortable(),this.props.set_focus&&(null!=this.cmobject&&(this.cmobject.focus(),this.cmobject.setCursor({line:0,ch:0})),this.props.setConsoleItemValue(this.props.unique_id,"set_focus",!1))}executeEmbeddedScripts(){let e=$("#"+this.props.unique_id+" .log-code-output script").toArray();for(let t of e)try{window.eval(t.text)}catch(e){}}makeTablesSortable(){let e=$("#"+this.props.unique_id+" table.sortable").toArray();for(let t of e)sorttable.makeSortable(t)}_runMe(e=!1){this._startMySpinner();let t=this;this._clearOutput(),Object(r.f)(main_id,"exec_console_code",{the_code:this.props.console_text,console_id:this.props.unique_id},(function(){e&&t.props.goToNextCell(t.props.unique_id)}))}_startMySpinner(){this.props.setConsoleItemValue(this.props.unique_id,"show_spinner",!0)}_stoptMySpinner(){this.props.setConsoleItemValue(this.props.unique_id,"show_spinner",!1)}_handleChange(e){this.props.setConsoleItemValue(this.props.unique_id,"console_text",e)}_handleSummaryTextChange(e){this.props.setConsoleItemValue(this.props.unique_id,"summary_text",e)}_toggleShrink(){this.props.setConsoleItemValue(this.props.unique_id,"am_shrunk",!this.props.am_shrunk)}_deleteMe(){this.props.handleDelete(this.props.unique_id)}_clearOutput(){this.props.setConsoleItemValue(this.props.unique_id,"output_text","")}_extraKeys(){let e=this;return{"Ctrl-Enter":()=>e._runMe(!0),"Cmd-Enter":()=>e._runMe(!0),"Ctrl-Alt-C":e.props.addNewCodeItem,"Ctrl-Alt-T":e.props.addNewTextItem}}_setCMObject(e){this.cmobject=e}render(){let e=this.props.am_shrunk?"log-panel log-panel-invisible":"log-panel log-panel-visible",t={__html:this.props.output_text};return React.createElement("div",{className:e+" d-flex flex-row",id:this.props.unique_id},React.createElement("div",{className:"button-div shrink-expand-div d-flex flex-row"},React.createElement(h,null),!this.props.am_shrunk&&React.createElement(i.b,{icon:"chevron-down",handleClick:this._toggleShrink}),this.props.am_shrunk&&React.createElement(i.b,{icon:"chevron-right",handleClick:this._toggleShrink})),this.props.am_shrunk&&React.createElement(c.EditableText,{value:this.props.summary_text,onChange:this._handleSummaryTextChange,className:"log-panel-summary"}),!this.props.am_shrunk&&React.createElement(React.Fragment,null,React.createElement("div",{className:"d-flex flex-column",style:{width:"100%"}},React.createElement("div",{className:"d-flex flex-row"},React.createElement("div",{className:"log-panel-body d-flex flex-row console-code"},React.createElement("div",{className:"button-div d-flex pr-1"},React.createElement(i.b,{handleClick:this._runMe,intent:"success",tooltip:"Execute this item",icon:"play"})),React.createElement(o.a,{handleChange:this._handleChange,code_content:this.props.console_text,setCMObject:this._setCMObject,extraKeys:this._extraKeys(),saveMe:null}),React.createElement("div",{className:"button-div d-flex flex-row"},React.createElement(i.b,{handleClick:this._deleteMe,intent:"danger",tooltip:"Delete this item",style:{marginLeft:10,marginRight:0},icon:"trash"}),React.createElement(i.b,{handleClick:this._clearOutput,intent:"warning",tooltip:"Clear this item's output",style:{marginLeft:10,marginRight:0},icon:"clean"}))),!this.props.show_spinner&&React.createElement("div",{className:"execution-counter"},"[",String(this.props.execution_count),"]"),this.props.show_spinner&&React.createElement("div",{style:{marginTop:10,marginRight:22}},React.createElement(c.Spinner,{size:13}))),React.createElement("div",{className:"log-code-output",dangerouslySetInnerHTML:t}))))}}m.propTypes={unique_id:PropTypes.string,am_shrunk:PropTypes.bool,set_focus:PropTypes.bool,show_spinner:PropTypes.bool,summary_text:PropTypes.string,console_text:PropTypes.string,output_text:PropTypes.string,execution_count:PropTypes.number,setConsoleItemValue:PropTypes.func,handleDelete:PropTypes.func,addNewTextItem:PropTypes.func,addNewCodeItem:PropTypes.func,goToNextCell:PropTypes.func,setFocus:PropTypes.func};class g extends React.Component{constructor(e){super(e),doBinding(this,"_"),this.ce_ref=null,this.ce_summary_ref=React.createRef(),this.converter=new showdown.Converter}componentDidMount(){this.props.set_focus&&(this.props.show_markdown?this._hideMarkdown():($(this.ce_ref.current).focus(),this.props.setConsoleItemValue(this.props.unique_id,"set_focus",!1)))}componentDidUpdate(){this.props.set_focus&&(this.props.show_markdown?this._hideMarkdown():($(this.ce_ref.current).focus(),this.props.setConsoleItemValue(this.props.unique_id,"set_focus",!1)))}get hasOnlyWhitespace(){return!this.props.console_text.trim().length}_showMarkdown(){this.hasOnlyWhitespace||this.props.setConsoleItemValue(this.props.unique_id,"show_markdown",!0)}_hideMarkdown(){this.props.setConsoleItemValue(this.props.unique_id,"show_markdown",!1)}_handleChange(e){this.props.setConsoleItemValue(this.props.unique_id,"console_text",e.target.value)}_handleSummaryTextChange(e){this.props.setConsoleItemValue(this.props.unique_id,"summary_text",e)}_toggleShrink(){this.props.setConsoleItemValue(this.props.unique_id,"am_shrunk",!this.props.am_shrunk)}_deleteMe(){this.props.handleDelete(this.props.unique_id)}_handleKeyDown(e){"Tab"==e.key&&(this.props.goToNextCell(this.props.unique_id),e.preventDefault())}_gotEnter(){this.props.goToNextCell(this.props.unique_id),this._showMarkdown()}_notesRefHandler(e){this.ce_ref=e}render(){let e=!this.hasOnlyWhitespace&&this.props.show_markdown;var t;e&&(t=this.converter.makeHtml(this.props.console_text));let s=[[["ctrl+enter","command+enter"],this._gotEnter]],o={__html:t},n=this.props.am_shrunk?"log-panel log-panel-invisible text-log-item":"log-panel log-panel-visible text-log-item";return React.createElement("div",{className:n+" d-flex flex-row",id:this.props.unique_id,style:{marginBottom:10}},React.createElement("div",{className:"button-div shrink-expand-div d-flex flex-row"},React.createElement(h,null),!this.props.am_shrunk&&React.createElement(i.b,{icon:"chevron-down",handleClick:this._toggleShrink}),this.props.am_shrunk&&React.createElement(i.b,{icon:"chevron-right",handleClick:this._toggleShrink})),this.props.am_shrunk&&React.createElement(c.EditableText,{value:this.props.summary_text,onChange:this._handleSummaryTextChange,className:"log-panel-summary"}),!this.props.am_shrunk&&React.createElement("div",{className:"d-flex flex-column",style:{width:"100%"}},React.createElement("div",{className:"log-panel-body text-box d-flex flex-row"},React.createElement("div",{className:"button-div d-inline-flex pr-1"},React.createElement(i.b,{handleClick:this._showMarkdown,intent:"success",tooltip:"Convert to/from markdown",icon:"paragraph"})),!e&&React.createElement(React.Fragment,null,React.createElement(c.TextArea,{value:this.props.console_text,onChange:this._handleChange,onKeyDown:this._handleKeyDown,growVertically:!0,onFocus:()=>this.props.setFocus(this.props.unique_id),onBlur:()=>this.props.setFocus(null),disabled:!1,className:"console-text",style:{},inputRef:this._notesRefHandler}),React.createElement(a.a,{target_ref:this.ce_ref,bindings:s})),e&&React.createElement("div",{className:"text-panel-output",onClick:this._hideMarkdown,style:{width:"100%",padding:9},dangerouslySetInnerHTML:o}),React.createElement("div",{className:"button-div d-flex flex-row"},React.createElement(i.b,{handleClick:this._deleteMe,intent:"danger",tooltip:"Delete this item",style:{marginLeft:10,marginRight:66},icon:"trash"})))))}}g.propTypes={unique_id:PropTypes.string,am_shrunk:PropTypes.bool,set_focus:PropTypes.bool,show_markdown:PropTypes.bool,summary_text:PropTypes.string,console_text:PropTypes.string,setConsoleItemValue:PropTypes.func,handleDelete:PropTypes.func,goToNextCell:PropTypes.func,tsocket:PropTypes.object,setFocus:PropTypes.func}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return TileContainer}));var _sortable_container_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18),_communication_react_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),_toaster_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_tile_form_react_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(21),_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3),_resizing_layouts_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9);let Rtg=window.ReactTransitionGroup,Bp=blueprint,Shoc=window.react_sortable_hoc;const using_touch="ontouchend"in document;var click_event;click_event=using_touch?"touchstart":"click";const TILE_DISPLAY_AREA_MARGIN=15,ANI_DURATION=300;function composeObjs(e,t){return Object.assign(Object.assign({},e),t)}class TileContainer extends React.Component{constructor(e){super(e),doBinding(this)}_handleTileFinishedLoading(e){this._setTileValue(e.tile_id,"finished_loading",!0)}componentDidMount(){let e=this;this.setState({mounted:!0}),this.props.tsocket.socket.off("tile-message"),this.props.tsocket.socket.on("tile-message",this._handleTileMessage),this.props.tsocket.socket.off("tile-finished-loading"),this.props.tsocket.socket.on("tile-finished-loading",t=>{e._handleTileFinishedLoading(t)}),this.props.tsocket.socket.off("tile-source-change"),this.props.tsocket.socket.on("tile-source-change",(function(t){e._markSourceChange(t.tile_type)}))}_resortTilesOld(e){let t=[];for(let s of e){let e=this.get_tile_entry(s);t.push(e)}this.props.setMainStateValue("tile_list",t)}_resortTiles({oldIndex:e,newIndex:t}){let s=[...this.props.tile_list],i=arrayMove(s,e,t);this.props.setMainStateValue("tile_list",i)}_markSourceChange(e){let t=[...this.props.tile_list],s=[];for(let i of t)i.tile_type==e&&s.push(i.tile_id);for(let e of s)this._setTileValue(e,"source_changed",!0)}get_tile_entry(e){return-1==this.tileIndex(e)?null:Object.assign({},this.props.tile_list[this.tileIndex(e)])}replace_tile_entry(e,t,s=null){let i=[...this.props.tile_list],o=this.tileIndex(e);i.splice(o,1,t),this.props.setMainStateValue("tile_list",i,s)}tileIndex(e){let t=0;for(let s of this.props.tile_list){if(s.tile_id==e)return t;++t}return-1}_closeTile(e){let t=this.tileIndex(e),s=[...this.props.tile_list];s.splice(t,1),this.props.setMainStateValue("tile_list",s);const i={main_id:window.main_id,tile_id:e};Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(window.main_id,"RemoveTile",i)}_setTileValue(e,t,s,i=null){let o=this.get_tile_entry(e);o[t]=s,this.replace_tile_entry(e,o,i)}_setTileState(e,t,s=null){let i=this.get_tile_entry(e);for(let e in t)i[e]=t[e];this.replace_tile_entry(e,i,s)}_displayTileContentWithJavascript(e,t){this._setTileState(e,{front_content:t.html,javascript_code:t.javascript_code,javascript_arg_dict:t.arg_dict})}_displayTileContent(e,t){this._setTileState(e,{front_content:t.html,javascript_code:null,javascript_arg_dict:null})}_handleTileMessage(e){let t=this,s={hideOptions:(e,s)=>t._setTileValue(e,"show_form",!1),startSpinner:(e,s)=>t._setTileValue(e,"show_spinner",!0),stopSpinner:(e,s)=>t._setTileValue(e,"show_spinner",!1),displayTileContent:t._displayTileContent,displayFormContent:(e,s)=>t._setTileValue(e,"form_data",s.form_data),displayTileContentWithJavascript:t._displayTileContentWithJavascript},i=e.tile_id;s[e.tile_message](i,e)}render(){let e={height:this.props.height};return this.props.table_is_shrunk&&(e.marginLeft="0.5rem"),React.createElement(_sortable_container_js__WEBPACK_IMPORTED_MODULE_0__.a,{id:"tile-div",style:e,container_ref:this.props.tile_div_ref,ElementComponent:STileComponent,key_field_name:"tile_name",item_list:this.props.tile_list,handle:".tile-name-div",onSortStart:(e,t)=>t.preventDefault(),onSortEnd:this._resortTiles,handleClose:this._closeTile,setTileValue:this._setTileValue,setTileState:this._setTileState,table_is_shrunk:this.props.table_is_shrunk,current_doc_name:this.props.current_doc_name,selected_row:this.props.selected_row,broadcast_event:this.props.broadcast_event,useDragHandle:!0,axis:"xy"})}}TileContainer.propTypes={setMainStateValue:PropTypes.func,table_is_shrunk:PropTypes.bool,tile_list:PropTypes.array,tile_div_ref:PropTypes.object,current_doc_name:PropTypes.string,height:PropTypes.number,broadcast_event:PropTypes.func,selected_row:PropTypes.number,tsocket:PropTypes.object};class RawSortHandle extends React.Component{render(){return React.createElement("span",{className:"tile-name-div"},React.createElement(Bp.Icon,{icon:"drag-handle-vertical",iconSize:15}),this.props.tile_name)}}const Shandle=Shoc.sortableHandle(RawSortHandle);class TileComponent extends React.Component{constructor(e){super(e),this.my_ref=React.createRef(),this.body_ref=React.createRef(),this.tda_ref=React.createRef(),this.left_glyphs_ref=React.createRef(),this.right_glyphs_ref=React.createRef(),this.state={header_height:34,max_name_width:1e3,mounted:!1,resizing:!1,dwidth:0,dheight:0},doBinding(this)}_broadcastTileSize(){Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(this.props.tile_id,"TileSizeChange",{width:this.tdaWidth,height:this.tdaHeight})}_resizeTileAreaOld(e,t,s=null){let i=$(this.body_ref.current).position().top;this.setState({header_height:i});let o={tile_height:t.size.height,tile_width:t.size.width};this.props.setTileState(this.props.tile_id,o,s)}_resizeTileArea(e,t){let s=$(this.body_ref.current).position().top;this.setState({header_height:s});let i={tile_height:this.props.tile_height+t,tile_width:this.props.tile_width+e};this.props.setTileState(this.props.tile_id,i,this._broadcastTileSize)}executeEmbeddedScripts(){let e=$("#"+this.props.tile_id+" .tile-display-area script").toArray();for(let t of e)try{window.eval(t.text)}catch(e){}}makeTablesSortable(){let e=$("#"+this.props.tile_id+" table.sortable").toArray();for(let t of e)sorttable.makeSortable(t)}get tdaWidth(){return this.props.tile_width-2*TILE_DISPLAY_AREA_MARGIN}get tdaHeight(){return this.props.tile_height-this.state.header_height-2*TILE_DISPLAY_AREA_MARGIN}_executeJavascript(){try{let selector="[id='"+this.props.tile_id+"'] .jscript-target";eval(this.props.javascript_code)(selector,this.tdaWidth,this.tdaHeight,this.props.javascript_arg_dict)}catch(e){Object(_toaster_js__WEBPACK_IMPORTED_MODULE_2__.b)({"alert-type":"alert-warning",message:"Error evaluating javascript: "+e.message})}}componentDidMount(){this.setState({mounted:!0}),this._broadcastTileSize(this.props.tile_width,this.props.tile_height),this.listen_for_clicks(),this.executeEmbeddedScripts(),this.makeTablesSortable(),this.props.javascript_code&&this._executeJavascript()}componentDidUpdate(){this.executeEmbeddedScripts(),this.makeTablesSortable(),this.props.javascript_code&&this._executeJavascript()}_toggleTileLog(){if(this.props.show_log)return void this.props.setTileState(this.props.tile_id,{show_log:!1,show_form:!1});const e=this;Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)("host","get_container_log",{container_id:this.props.tile_id},(function(t){e.props.setTileState(e.props.tile_id,{show_log:!0,show_form:!1,log_content:t.log_text}),e._setTileBack(!1)}))}_toggleShrunk(){this.props.setTileValue(this.props.tile_id,"shrunk",!this.props.shrunk)}_closeTile(){this.props.handleClose(this.props.tile_id)}_standard_click_data(){return{tile_id:this.props.tile_id,main_id:window.main_id,doc_name:this.props.current_doc_name,active_row_id:this.props.selected_row}}_updateOptionValue(e,t){let s=[...this.props.form_data];for(let i of s)if(i.name==e){i.starting_value=t;break}this.props.setTileValue(this.props.tile_id,"form_data",s)}_toggleBack(){this.props.setTileState(this.props.tile_id,{show_log:!1,show_form:!this.props.show_form})}_setTileBack(e){this.props.setTileValue(this.props.tile_id,"show_form",e)}_handleSubmitOptions(){this.props.setTileValue(this.props.tile_id,"show_form",!1),this._startSpinner(),this.props.setTileValue(this.props.tile_id,"show_spinner",!0);let e={};for(let t of this.props.form_data)e[t.name]=t.starting_value;e.tile_id=this.props.tile_id,this.props.broadcast_event("UpdateOptions",e)}_startSpinner(){this.props.setTileValue(this.props.tile_id,"show_spinner",!0)}_stopSpinner(){this.props.setTileValue(this.props.tile_id,"show_spinner",!1)}_displayFormContent(e){this.props.setTileValue(this.props.tile_id,"form_data",e.form_data)}spin_and_refresh(){this._startSpinner();const e=this;Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(this.props.tile_id,"RefreshTile",{},(function(){e._stopSpinner()}))}_reloadTile(){const e=this,t={tile_id:this.props.tile_id,tile_name:this.props.tile_name};this._startSpinner(),Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(main_id,"reload_tile",t,(function(t){t.success&&(e._displayFormContent(t),e.props.setTileValue(e.props.tile_id,"source_changed",!1),t.options_changed?(e._stopSpinner(),e._setTileBack(!0)):e.spin_and_refresh())}))}listen_for_clicks(){let e=this;$(this.body_ref.current).on(click_event,".element-clickable",(function(t){let s=e._standard_click_data();const i=t.target.dataset;s.dataset={};for(let e in i)i.hasOwnProperty(e)&&(s.dataset[e]=i[e]);Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"TileElementClick",s),t.stopPropagation()})),$(this.body_ref.current).on(click_event,".word-clickable",(function(t){let s=e._standard_click_data();const i=window.getSelection(),o=i.getRangeAt(0),n=i.anchorNode;for(;0!==o.toString().indexOf(" ")&&0!==o.startOffset;)o.setStart(n,o.startOffset-1);const a=n.textContent.length;0!==o.startOffset&&o.setStart(n,o.startOffset+1);do{o.setEnd(n,o.endOffset+1)}while(-1==o.toString().indexOf(" ")&&""!==o.toString().trim()&&o.endOffset<a);s.clicked_text=o.toString().trim(),Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"TileWordClick",s)})),$(this.body_ref.current).on(click_event,".cell-clickable",(function(t){let s=e._standard_click_data();s.clicked_cell=$(this).text(),Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"TileCellClick",s)})),$(this.body_ref.current).on(click_event,".row-clickable",(function(t){let s=e._standard_click_data();const i=$(this).children(),o=[];i.each((function(){o.push($(this).text())})),s.clicked_row=o,Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"TileRowClick",s)})),$(this.body_ref.current).on(click_event,".front button",(function(t){let s=e._standard_click_data();s.button_value=t.target.value,Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"TileButtonClick",s)})),$(this.body_ref.current).on("submit",".front form",(function(t){let s=e._standard_click_data();const i={};let o=t.target;for(let e=0;e<o.length;e+=1)i[o[e].name]=o[e].value;return s.form_data=i,Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"TileFormSubmit",s),!1})),$(this.body_ref.current).on("change",".front select",(function(t){let s=e._standard_click_data();s.select_value=t.target.value,Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"SelectChange",s)})),$(this.body_ref.current).on("change",".front textarea",(function(t){let s=e._standard_click_data();s.text_value=t.target.value,Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(e.props.tile_id,"TileTextAreaChange",s)}))}compute_styles(){let e=this.props.shrunk?this.state.header_height:this.props.tile_height;if(this.front_style={width:this.props.tile_width,height:e-this.state.header_height},this.tda_style={width:this.props.tile_width-2*TILE_DISPLAY_AREA_MARGIN,height:e-this.state.header_height-2*TILE_DISPLAY_AREA_MARGIN},this.state.mounted){let e=this.left_glyphs_ref.current.getBoundingClientRect(),t=this.right_glyphs_ref.current.getBoundingClientRect().x-e.x-10;this.lg_style={width:t,overflow:"hidden"}}else this.lg_style={};this.back_style=Object.assign({},this.front_style),this.tile_log_style=Object.assign({},this.front_style),this.panel_body_style={width:this.props.tile_width},this.main_style={width:this.props.tile_width+this.state.dwidth,height:e+this.state.dheight,position:"relative"},this.props.finished_loading||(this.main_style.opacity=.5),this.front_style.transition=`top ${ANI_DURATION}ms ease-in-out`,this.back_style.transition=`top ${ANI_DURATION}ms ease-in-out`,this.transitionStylesAltUp={transition:`top ${ANI_DURATION}ms ease-in-out`,entering:{top:this.state.header_height},entered:{top:this.state.header_height},exiting:{top:-1*e},exited:{top:-1*e}},this.transitionStylesAltDown={entering:{top:this.state.header_height},entered:{top:this.state.header_height},exiting:{top:e+50},exited:{top:e+50}},this.tile_log_style.transition=`opacity ${ANI_DURATION}ms ease-in-out`,this.transitionFadeStyles={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0,width:0,height:0,padding:0},exited:{opacity:0,width:0,height:0,padding:0}}}logText(e){Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)("host","print_to_console",{message:e,is_error:!1,user_id:window.user_id,main_id:window.main_id},(function(e){e.success||Object(_toaster_js__WEBPACK_IMPORTED_MODULE_2__.b)(e)}))}_logMe(){this.logText(this.props.front_content)}_logParams(){const e={};e.main_id=window.main_id,e.tile_id=this.props.tile_id,e.tile_name=this.props.tile_name,Object(_communication_react_js__WEBPACK_IMPORTED_MODULE_1__.f)(this.props.tile_id,"LogParams",e)}_startResize(e,t,s,i){this.setState({resizing:!0,dwidth:0,dheight:0})}_onResize(e,t,s,i,o,n){this.setState({dwidth:o,dheight:n})}_stopResize(e,t,s,i,o,n){this.setState({resizing:!1,dwidth:0,dheight:0},()=>{this._resizeTileArea(o,n)})}render(){let e=!this.props.show_form&&!this.props.show_log,t={__html:this.props.front_content};this.compute_styles();let s=this.props.table_is_shrunk?"tile-panel tile-panel-float":"tile-panel",i=this.props.source_changed?"tile-panel-heading tile-source-changed":"tile-panel-heading";return React.createElement(Bp.Card,{ref:this.my_ref,elevation:2,style:this.main_style,className:s,id:this.props.tile_id},React.createElement("div",{className:i},React.createElement("div",{className:"left-glyphs",ref:this.left_glyphs_ref,style:this.lg_style},React.createElement(Bp.ButtonGroup,null,this.props.shrunk&&React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{icon:"chevron-right",handleClick:this._toggleShrunk}),!this.props.shrunk&&React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{icon:"chevron-down",handleClick:this._toggleShrunk}),React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{intent:"primary",handleClick:this._toggleBack,icon:"cog"}),React.createElement(Shandle,{tile_name:this.props.tile_name}))),React.createElement("div",{className:"right-glyphs",ref:this.right_glyphs_ref},React.createElement(Bp.ButtonGroup,null,this.props.show_spinner&&React.createElement(Bp.Spinner,{size:17}),React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{handleClick:this._toggleTileLog,tooltip:"Show tile container log",icon:"console"}),React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{handleClick:this._logMe,tooltip:"Send current display to log",icon:"clipboard"}),React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{handleClick:this._logParams,tooltip:"Send current parameters to log",icon:"th"}),React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{intent:"warning",handleClick:this._reloadTile,tooltip:"Reload tile source from library and rerun",icon:"refresh"}),React.createElement(_blueprint_react_widgets_js__WEBPACK_IMPORTED_MODULE_4__.b,{intent:"danger",handleClick:this._closeTile,ttooltip:"Remove tile",icon:"trash"})))),!this.props.shrunk&&React.createElement("div",{ref:this.body_ref,style:this.panel_body_style,className:"tile-body"},React.createElement(Rtg.Transition,{in:this.props.show_form,timeout:ANI_DURATION},e=>React.createElement("div",{className:"back",style:composeObjs(this.back_style,this.transitionStylesAltUp[e])},React.createElement(_tile_form_react_js__WEBPACK_IMPORTED_MODULE_3__.a,{options:this.props.form_data,tile_id:this.props.tile_id,updateValue:this._updateOptionValue,handleSubmit:this._handleSubmitOptions}))),React.createElement(Rtg.Transition,{in:this.props.show_log,timeout:ANI_DURATION},e=>React.createElement("div",{className:"tile-log",style:composeObjs(this.tile_log_style,this.transitionFadeStyles[e])},React.createElement("div",{className:"tile-log-area"},React.createElement("pre",{style:{fontSize:12}},this.props.log_content)))),React.createElement(Rtg.Transition,{in:e,timeout:ANI_DURATION},e=>React.createElement("div",{className:"front",style:composeObjs(this.front_style,this.transitionStylesAltDown[e])},React.createElement("div",{className:"tile-display-area",style:this.state.tda_style,ref:this.tda_ref,dangerouslySetInnerHTML:t})))),React.createElement(_resizing_layouts_js__WEBPACK_IMPORTED_MODULE_5__.a,{position_dict:{position:"absolute",bottom:2,right:1},dragStart:this._startResize,onDrag:this._onResize,dragEnd:this._stopResize,direction:"both",iconSize:15}))}}TileComponent.propTypes={tile_name:PropTypes.string,tile_id:PropTypes.string,form_data:PropTypes.array,front_content:PropTypes.string,javascript_code:PropTypes.string,javascript_arg_dict:PropTypes.object,source_changed:PropTypes.bool,tile_width:PropTypes.number,tile_height:PropTypes.number,show_form:PropTypes.bool,show_spinner:PropTypes.bool,shrunk:PropTypes.bool,show_log:PropTypes.bool,current_doc_name:PropTypes.string,setTileValue:PropTypes.func,setTileState:PropTypes.func,broadcast_event:PropTypes.func,handleReload:PropTypes.string,handleClose:PropTypes.func},TileComponent.defaultProps={javascript_code:null};let STileComponent=Shoc.sortableElement(TileComponent)},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s(13);let o=blueprint;class n extends React.Component{constructor(e){super(e),doBinding(this),this.selector_types=["column_select","tokenizer_select","weight_function_select","cluster_metric","tile_select","document_select","list_select","collection_select","function_select","class_select","palette_select","custom_list"]}_updateValue(e,t){this.props.updateValue(e,t)}_submitOptions(){this.props.handleSubmit(this.props.tile_id)}render(){var e=[];for(let t of this.props.options){let s=t.name;this.selector_types.includes(t.type)?e.push(React.createElement(l,{att_name:s,key:s,choice_list:t.option_list,value:t.starting_value,updateValue:this._updateValue})):"pipe_select"==t.type?e.push(React.createElement(c,{att_name:s,key:s,value:t.starting_value,pipe_dict:t.pipe_dict,updateValue:this._updateValue})):"textarea"==t.type?e.push(React.createElement(r,{att_name:s,key:s,value:t.starting_value,updateValue:this._updateValue})):"codearea"==t.type?e.push(React.createElement(r,{att_name:s,key:s,value:t.starting_value,updateValue:this._updateValue})):"text"!=t.type&&"int"!=t.type||e.push(React.createElement(a,{att_name:s,key:s,value:t.starting_value,updateValue:this._updateValue}))}return React.createElement(React.Fragment,null,React.createElement("form",{className:"form-display-area",onSubmit:this._submitOptions},e),React.createElement(o.Button,{text:"Submit",intent:"primary",onClick:this._submitOptions}))}}n.propTypes={tile_id:PropTypes.string,options:PropTypes.array,handleSubmit:PropTypes.func,updateValue:PropTypes.func};class a extends React.Component{constructor(e){super(e),doBinding(this)}_updateMe(e){this.props.updateValue(this.props.att_name,e.target.value)}render(){return React.createElement(o.FormGroup,{label:this.props.att_name},React.createElement(o.InputGroup,{type:"text",small:!1,onChange:this._updateMe,value:this.props.value}))}}a.propTypes={att_name:PropTypes.string,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),updateValue:PropTypes.func};(class extends React.Component{constructor(e){super(e),doBinding(this)}_updateMe(e){this.props.updateValue(this.props.att_name,e.target.value)}render(){return React.createElement(o.Checkbox,{label:this.props.att_name,value:this.props.value,onChange:this._updateMe,alignIndicator:"right"})}}).propTypes={att_name:PropTypes.string,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),updateValue:PropTypes.func};(class extends React.Component{constructor(e){super(e),doBinding(this)}_updateMe(e){this.props.updateValue(this.props.att_name,e)}render(){return React.createElement(o.FormGroup,{label:this.props.att_name},React.createElement(i.a,{handleChange:this._updateMe,code_content:this.props.value,saveMe:null,code_container_height:100}))}}).propTypes={att_name:PropTypes.string,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),updateValue:PropTypes.func};class r extends React.Component{constructor(e){super(e),doBinding(this)}_updateMe(e){this.props.updateValue(this.props.att_name,e.target.value)}render(){return React.createElement(o.FormGroup,{label:this.props.att_name},React.createElement(o.TextArea,{onChange:this._updateMe,small:!1,value:this.props.value}))}}r.propTypes={att_name:PropTypes.string,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),updateValue:PropTypes.func};class l extends React.Component{constructor(e){super(e),doBinding(this)}_updateMe(e){this.props.updateValue(this.props.att_name,e.target.value)}render(){let e=this.props.choice_list.map((e,t)=>React.createElement("option",{key:t},e));return React.createElement(o.FormGroup,{label:this.props.att_name},React.createElement(o.HTMLSelect,{onChange:this._updateMe,value:this.props.value},e))}}l.propTypes={att_name:PropTypes.string,choice_list:PropTypes.array,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),updateValue:PropTypes.func};class c extends React.Component{constructor(e){super(e),doBinding(this)}_updateMe(e){this.props.updateValue(this.props.att_name,e.target.value)}create_groups(){let e=[];for(let t in this.props.pipe_dict)e.push(React.createElement("optgroup",{key:t,label:t},this.props.pipe_dict[t].map(e=>React.createElement("option",{key:e[1],value:e[0]},e[1]))));return e}render(){return React.createElement(o.FormGroup,{label:this.props.att_name},React.createElement(o.HTMLSelect,{onChange:this._updateMe,value:this.props.value},this.create_groups()))}}c.propTypes={att_name:PropTypes.string,pipe_dict:PropTypes.object,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),updateValue:PropTypes.func}},,,,,,,,,,function(e,t,s){"use strict";s.r(t);var i=s(7),o=s(3),n=s(13);let a=blueprint;class r extends React.Component{constructor(e){super(e),this.cmobject=null,this.overlay=null,doBinding(this)}_setCMObject(e){this.cmobject=e}_clearSearch(){this.cmobject&&this.overlay&&(this.cmobject.removeOverlay(this.overlay),this.overlay=null)}_doSearch(){this.props.alt_search_text&&""!=this.props.alt_search_text&&this.cmobject?(this.overlay=this.mySearchOverlay(this.props.alt_search_text,!0),this.cmobject.addOverlay(this.overlay)):this.props.search_text&&""!=this.props.search_text&&this.cmobject&&(this.overlay=this.mySearchOverlay(this.props.search_text,!0),this.cmobject.addOverlay(this.overlay))}mySearchOverlay(e,t){return"string"==typeof e?e=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t?"gi":"g"):e.global||(e=new RegExp(e.source,e.ignoreCase?"gi":"g")),{token:function(t){e.lastIndex=t.pos;const s=e.exec(t.string);if(s&&s.index==t.pos)return t.pos+=s[0].length||1,"searching";s?t.pos=s.index:t.skipToEnd()}}}_handleChange(){}render(){return this._clearSearch(),this._doSearch(),React.createElement("div",{ref:this.props.my_ref},React.createElement(n.a,{handleChange:this._handleChange,code_content:this.props.data_text,sync_to_prop:!0,mode:"Plain Text",code_container_height:this.props.code_container_height,setCMObject:this._setCMObject,readOnly:!0}))}}r.propTypes={my_ref:PropTypes.object,data_text:PropTypes.string,code_container_height:PropTypes.number,search_text:PropTypes.string,alt_search_text:PropTypes.string};class l extends React.Component{constructor(e){super(e),doBinding(this),this.heading_left_ref=React.createRef(),this.heading_right_ref=React.createRef(),this.state={hide_right_element:!1}}componentDidUpdate(){let e=this.heading_left_ref.current.getBoundingClientRect(),t=this.heading_right_ref.current.getBoundingClientRect().x<e.x+e.width+10;t!=this.state.hide_right_element&&this.setState({hide_right_element:t})}_handleSearchFieldChange(e){this.props.handleSearchFieldChange(e.target.value)}_handleFilter(){let e=this;const t={text_to_find:this.props.search_text};this.props.broadcast_event_to_server("UnfilterTable",t,(function(){""!==e.props.search_text&&(e.props.broadcast_event_to_server("FilterTable",t),e.props.setMainStateValue("table_is_filtered",!0))}))}_handleUnFilter(){this.props.handleSearchFieldChange(null),this.props.table_is_filtered&&(this.props.broadcast_event_to_server("UnfilterTable",{}),this.props.setMainStateValue("table_is_filtered",!1))}_handleSubmit(e){e.preventDefault()}_onChangeDoc(e){this.props.handleChangeDoc(e.target.value)}render(){let e=this.state.hide_right_element?0:100;return React.createElement("div",{className:"d-flex pl-2 pr-2 justify-content-between align-baseline main-heading",style:{height:50}},React.createElement("div",{id:"heading-left",ref:this.heading_left_ref,className:"d-flex flex-column justify-content-around"},React.createElement("div",{className:"d-flex flex-row"},React.createElement(o.b,{handleClick:this.props.toggleShrink,icon:"minimize"}),React.createElement("div",{className:"d-flex flex-column justify-content-around"},React.createElement("form",{className:"d-flex flex-row"},React.createElement(a.FormGroup,{label:this.props.short_collection_name,inline:!0,style:{marginBottom:0,marginLeft:5,marginRight:10}},React.createElement(a.HTMLSelect,{options:this.props.doc_names,onChange:this._onChangeDoc,value:this.props.current_doc_name,style:{height:30,maxWidth:200}})),this.props.show_table_spinner&&React.createElement(a.Spinner,{size:15}))))),React.createElement("div",{id:"heading-right",ref:this.heading_right_ref,style:{opacity:e},className:"d-flex flex-column justify-content-around"},React.createElement("form",{onSubmit:this._handleSubmit,className:"d-flex flex-row"},React.createElement(a.InputGroup,{type:"search",leftIcon:"search",placeholder:"Search",value:this.props.search_text?this.props.search_text:"",onChange:this._handleSearchFieldChange,autoCapitalize:"none",autoCorrect:"off",className:"mr-2"}),React.createElement(a.ButtonGroup,null,this.props.show_filter_button&&React.createElement(a.Button,{onClick:this._handleFilter},"Filter"),React.createElement(a.Button,{onClick:this._handleUnFilter},"Clear")))))}}l.propTypes={toggleShrink:PropTypes.func,table_is_filtered:PropTypes.bool,setMainStateValue:PropTypes.func,handleSearchFieldChange:PropTypes.func,search_text:PropTypes.string,handleFilter:PropTypes.func,short_collection_name:PropTypes.string,current_doc_name:PropTypes.string,handleChangeDoc:PropTypes.func,doc_names:PropTypes.array,show_table_spinner:PropTypes.bool,show_filter_button:PropTypes.bool,broadcast_event_to_server:PropTypes.func};class c extends React.Component{constructor(e){super(e),this.state={mounted:!1,selected_row:null},doBinding(this)}componentDidMount(){this.setState({mounted:!0})}render(){return React.createElement(a.Card,{id:"main-panel",elevation:2},this.props.card_header,React.createElement("div",{id:"table-wrapper"},this.props.card_body))}}c.propTypes={card_body:PropTypes.object,card_header:PropTypes.object,updateTableSpec:PropTypes.func,table_spec:PropTypes.object,broadcast_event_to_server:PropTypes.func};let p=bptable;const _=400;class h extends React.Component{render(){let e={backgroundColor:this.props.the_color};return React.createElement("span",{style:e},this.props.the_word)}}h.propTypes={the_color:PropTypes.string,the_word:PropTypes.string};class d extends React.Component{constructor(e){super(e),doBinding(this),this.mismatched_column_widths=!1,this.table_ref=React.createRef()}componentDidMount(){this.setState({mounted:!0}),this.computeColumnWidths(),this._updateRowHeights()}componentDidUpdate(){(null==this.props.column_widths||this.mismatched_column_widths)&&this.computeColumnWidths(),this._updateRowHeights()}computeColumnWidths(){let e=function(e,t){e.length;const s=_;let i,o,n,a=$($(".bp3-table-truncated-text")[0]).css("font"),r=a,l=document.getElementById("measure-canvas").getContext("2d"),c={},p=[];for(let t of e)c[t]=0,p.push(t);l.font=r;for(let t of p){if(n=e[t],(o=l.measureText(n).width+40)>s){o=s;let e=p.indexOf(t);-1!==e&&p.splice(e,1)}o>c[t]&&(c[t]=o)}l.font=a;let h=Object.keys(t);for(let e=0;e<h.length&&0!=p.length;++e){i=t[h[e]];let a=[];for(let e of p)n=i[e],(o=l.measureText(n).width+40)>s&&(o=s,a.push(e)),o>c[e]&&(c[e]=o);for(let e of a){let t=p.indexOf(e);-1!==t&&p.splice(t,1)}}let d=[];for(let t of e)d.push(c[t]);return d}(this.props.filtered_column_names,this.props.data_row_dict);this.mismatched_column_widths=!1,this.props.updateTableSpec({column_widths:e},!0)}haveRowData(e){return this.props.data_row_dict.hasOwnProperty(e)}_scrollToRow(e){if(this.table_ref&&this.table_ref.current){let t=p.Regions.cell(e,0);this.table_ref.current.scrollToRegion(t)}}_updateRowHeights(){let e=this.props.filtered_column_names,t=this;this.table_ref.current.resizeRowsByApproximateHeight((s,i)=>t.haveRowData(s)?t.props.data_row_dict[s][e[i]]:"empty cell",{getNumBufferLines:1})}_rowHeaderCellRenderer(e){return this.haveRowData(e)?React.createElement(p.RowHeaderCell,{key:e,name:this.props.data_row_dict[e].__id__}):React.createElement(p.RowHeaderCell,{key:e,loading:!0,name:e})}_text_color_dict(e,t){if(this.props.cells_to_color_text.hasOwnProperty(e)){let s=this.props.cells_to_color_text[e];return s.hasOwnProperty(t)?s[t]:null}return null}_cellRendererCreator(e){let t=this;return s=>{if(!this.haveRowData(s))return t.props.awaiting_data||t.props.initiateDataGrab(s),React.createElement(p.Cell,{key:e,loading:!0});let i=t._text_color_dict(s,e);if(i){let t=i.color_dict,s=i.token_text,o=[],n=0;for(let e of s)t.hasOwnProperty(e)?o.push(React.createElement(h,{key:n,the_color:t[e],the_word:e})):o.push(e+" "),n+=1;return React.createElement(p.Cell,{key:e,truncated:!0,wrapText:!0},o)}let o=t.props.data_row_dict[s][e];if(null!=this.props.alt_search_text&&""!=this.props.alt_search_text){const t=new RegExp(this.props.alt_search_text,"gi");let s={__html:o=String(o).replace(t,(function(e){return"<mark>"+e+"</mark>"}))};return React.createElement(p.Cell,{key:e,truncated:!0,wrapText:!0},React.createElement("div",{dangerouslySetInnerHTML:s}))}if(null!=t.props.search_text&&""!=t.props.search_text){const s=new RegExp(t.props.search_text,"gi");let i={__html:o=String(o).replace(s,(function(e){return"<mark>"+e+"</mark>"}))};return React.createElement(p.Cell,{key:e,truncated:!0,wrapText:!0},React.createElement("div",{dangerouslySetInnerHTML:i}))}return React.createElement(p.EditableCell,{key:e,truncated:!0,rowIndex:s,columnIndex:this.props.filtered_column_names.indexOf(e),wrapText:!0,onConfirm:t._onConfirmCellEdit,value:o})}}_onConfirmCellEdit(e,t,s){this.props.setCellContent(this.props.data_row_dict[t].__id__,this.props.filtered_column_names[s],e,!0)}_onSelection(e){0!=e.length&&(e[0].hasOwnProperty("cols")?this._setSelectedColumn(this.props.filtered_column_names[e[0].cols[0]]):e[0].hasOwnProperty("rows")&&this._setSelectedRow(e[0].rows[0]))}_setSelectedColumn(e){this.props.setMainStateValue("selected_column",e)}_setSelectedRow(e){this.props.setMainStateValue("selected_row",this.props.data_row_dict[e].__id__)}broadcast_column_widths(e,t){this.props.broadcast_event_to_server("UpdateColumnWidths",{doc_to_update:e,column_widths:t},null)}_onColumnWidthChanged(e,t){let s=this.props.column_widths;s[e]=t,this.props.updateTableSpec({column_widths:s},!0)}_onColumnsReordered(e,t,s){let i=this.props.filtered_column_names[e],o=[...this.props.filtered_column_names];o.splice(e,1);let n=o[t];this.props.moveColumn(i,n)}render(){let e=this,t=this.props.filtered_column_names.map(t=>{const s=e._cellRendererCreator(t);return React.createElement(p.Column,{cellRenderer:s,enableColumnReordering:!0,key:t,name:t})}),s=null==this.props.column_widths?null:this.props.column_widths;null!=s&&s.length!=this.props.filtered_column_names.length&&(s=null,this.mismatched_column_widths=!0);let i={display:"block",overflowY:"auto",overflowX:"hidden",height:this.props.height};return React.createElement("div",{id:"table-area",ref:this.props.my_ref,style:i},React.createElement(p.Table,{ref:this.table_ref,numRows:this.props.total_rows,enableColumnReordering:!0,onColumnsReordered:this._onColumnsReordered,onSelection:this._onSelection,onColumnWidthChanged:this._onColumnWidthChanged,enableMultipleSelection:!1,selectionModes:[p.RegionCardinality.FULL_COLUMNS,p.RegionCardinality.FULL_ROWS],minColumnWidth:75,columnWidths:s,rowHeaderCellRenderer:this._rowHeaderCellRenderer},t))}}d.propTypes={my_ref:PropTypes.object,height:PropTypes.number,setCellContent:PropTypes.func,column_names:PropTypes.array,filtered_column_names:PropTypes.array,moveColumn:PropTypes.func,updateTableSpec:PropTypes.func,data_row_dict:PropTypes.object,total_rows:PropTypes.number,initiateDataGrab:PropTypes.func,setMainStateValue:PropTypes.func,broadcast_event_to_server:PropTypes.func,cells_to_color_text:PropTypes.object,column_widths:PropTypes.array,hidden_columns_list:PropTypes.array,search_text:PropTypes.string,alt_search_text:PropTypes.string};var u=s(10),m=s(9),g=s(5),f=s(20),b=s(0),y=s(1);let w=blueprint;class T extends React.Component{constructor(e){super(e),doBinding(this),this.select_ref=null,this.export_index={}}_updateMe(e){let t=e.target.value;this.props.handleChange(t,this.export_index[t])}componentDidUpdate(){if(this.select_ref){let e=this.select_ref.value;e&&e!=this.props.value&&this.props.handleChange(e,this.export_index[e])}}create_groups(){let e=[];for(let t in this.props.pipe_dict){let s=[];for(let e of this.props.pipe_dict[t]){let t=e[0],i=e[1];this.export_index[t]=i,s.push(React.createElement("option",{key:t,value:t},i))}e.push(React.createElement("optgroup",{key:t,label:t},s))}return e}_handleSelectRef(e){this.select_ref=e}render(){return React.createElement(w.HTMLSelect,{elementRef:this._handleSelectRef,onChange:this._updateMe,minimal:!0,value:this.props.value},this.create_groups())}}T.propTypes={pipe_dict:PropTypes.object,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),handleChange:PropTypes.func};class R extends React.Component{constructor(e){super(e),doBinding(this),this.header_ref=React.createRef(),this.state={selected_export:"",key_list:null,key_list_value:null,tail_value:"",exports_info_value:null,selected_export_short_name:null,show_spinner:!1,exports_body_value:"",type:null,pipe_dict:{}}}componentDidMount(){this.props.setUpdate(this._updateExportsList),this.props.tsocket.socket.off("export-viewer-message"),this.props.tsocket.socket.on("export-viewer-message",this._handleExportViewerMessage),this._updateExportsList()}_handleExportViewerMessage(e){let t=this;({update_exports_popup:()=>t._updateExportsList()})[e.export_viewer_message](e)}_updateExportsList(){let e=this;Object(b.f)(window.main_id,"get_full_pipe_dict",{},(function(t){e.setState({pipe_dict:t.pipe_dict,pipe_dict_updated:!0})}))}_refresh(){this._handleExportListChange(this.state.selected_export,this.state.selected_export_short_name,!0)}_eval(e=null){this._startSpinner();let t={export_name:this.state.selected_export,tail:this.state.tail_value};this.state.key_list&&(t.key=this.state.key_list_value);let s=this;Object(b.f)(main_id,"evaluate_export",t,(function(e){s.setState({exports_body_value:e.the_html,show_spinner:!1})})),e&&e.preventDefault()}_startSpinner(){this.setState({show_spinner:!0})}_handleExportListChange(e,t,s=!1){let i=this;(s||e!=this.state.selected_export)&&(this.setState({show_spinner:!0,selected_export:e,selected_export_short_name:t}),Object(b.f)(window.main_id,"get_export_info",{export_name:e},(function(e){let t={type:e.type,exports_info_value:e.info_string,tail_value:"",show_spinner:!1};e.hasOwnProperty("key_list")?t.key_list=e.key_list:t.key_list=null,i.setState(t)})))}_handleKeyListChange(e){this.setState({key_list_value:e})}_handleTailChange(e){this.setState({tail_value:e.target.value})}_bodyHeight(){return this.header_ref&&this.header_ref.current?this.props.available_height-$(this.header_ref.current).outerHeight():this.props.available_height-75}_sendToConsole(){const e=this.state.tail_value;let t=this.state.selected_export,s="";null!=this.state.key_list&&(s=`["${this.state.key_list_value}"]`);let i=`self.get_pipe_value("${t}")`+s+e;Object(b.f)("host","print_code_area_to_console",{console_text:i,user_id:window.user_id,main_id:window.main_id},(function(e){e.success||Object(y.b)(e)}))}render(){let e={__html:this.state.exports_body_value},t=this.props.console_is_shrunk?"am-shrunk":"not-shrunk";return this.props.console_is_zoomed&&(t="am-zoomed"),React.createElement(w.Card,{id:"exports-panel",elevation:2,className:"mr-3 "+t},React.createElement("div",{className:"d-flex flex-column justify-content-around"},React.createElement("div",{id:"exports-heading",ref:this.header_ref,className:"d-flex flex-row justify-content-start"},React.createElement(o.b,{handleClick:this._sendToConsole,intent:"primary",tooltip:"Send code to the console",style:{marginLeft:6},icon:"direction-left"}),React.createElement(o.b,{handleClick:this._refresh,intent:"success",tooltip:"Refresh the exports menu and info",style:{marginLeft:0},icon:"refresh"}),React.createElement(w.Button,{onClick:this._eval,intent:"success",style:{marginRight:0,marginLeft:0,padding:0},minimal:!0,small:!0,text:"Eval"}),Object.keys(this.state.pipe_dict).length>0&&React.createElement("form",{onSubmit:this._eval,className:"d-flex flex-row"},React.createElement(T,{pipe_dict:this.state.pipe_dict,value:this.state.selected_export,handleChange:this._handleExportListChange}),this.state.key_list&&React.createElement(o.e,{option_list:this.state.key_list,onChange:this._handleKeyListChange,the_value:this.state.key_list_value,minimal:!0,fontSize:11}),React.createElement(w.InputGroup,{type:"text",small:!0,onChange:this._handleTailChange,onSubmit:this._eval,value:this.state.tail_value})),React.createElement("span",{id:"exports-info",className:"bottom-heading-element ml-2"},this.state.exports_info_value),this.state.show_spinner&&React.createElement(w.Spinner,{size:13})),!this.props.console_is_shrunk&&React.createElement("div",{style:{overflowY:"scroll",padding:15,height:this._bodyHeight(),backgroundColor:"white"},dangerouslySetInnerHTML:e})))}}R.propTypes={available_height:PropTypes.number,console_is_shrunk:PropTypes.bool,console_is_zoomed:PropTypes.bool,setUpdate:PropTypes.func,tsocket:PropTypes.object};var C=s(2),x=s(19),v=s(12);s.d(t,"MainTacticSocket",(function(){return B}));var S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e};let E=blueprint;bptable;const k=17,P=35,O=8,j=35,M=500;var D=setInterval((function(){Object(b.b)("register_heartbeat",{main_id:window.main_id},(function(){}))}),1e4);let I,A;function N(e){let t=Object(v.a)(Object(y.d)(L,I),I);var s;window.is_project&&(window._collection_name=e.collection_name,window.doc_names=e.doc_names,window.short_collection_name=e.short_collection_name,s=e.interface_state),window.is_freeform?Object(b.f)(window.main_id,"grab_freeform_data",{doc_name:window.doc_names[0],set_visible_doc:!0},(function(e){let i=document.querySelector("#main-root");window.is_project?ReactDOM.render(React.createElement(t,{is_project:!0,interface_state:s,initial_data_text:e.data_text,initial_doc_names:window.doc_names}),i):ReactDOM.render(React.createElement(t,{is_project:!1,interface_state:null,initial_data_text:e.data_text,initial_doc_names:window.doc_names}),i)})):Object(b.f)(window.main_id,"grab_chunk_by_row_index",{doc_name:window.doc_names[0],row_index:0,set_visible_doc:!0},(function(e){let i=document.querySelector("#main-root");window.is_project?ReactDOM.render(React.createElement(t,{is_project:!0,interface_state:s,total_rows:e.total_rows,initial_column_names:e.table_spec.header_list,initial_data_row_dict:e.data_row_dict,initial_column_widths:e.table_spec.column_widths,initial_hidden_columns_list:e.table_spec.hidden_columns_list,initial_doc_names:window.doc_names}),i):ReactDOM.render(React.createElement(t,{is_project:!1,interface_state:null,total_rows:e.total_rows,initial_column_names:e.table_spec.header_list,initial_data_row_dict:e.data_row_dict,initial_column_widths:e.table_spec.column_widths,initial_hidden_columns_list:e.table_spec.hidden_columns_list,initial_doc_names:window.doc_names}),i)}))}window.onunload=function(e){Object(b.e)("host","remove_mainwindow_task",{main_id:window.main_id})};const z=["tile_list","table_is_shrunk","console_width_fraction","horizontal_fraction","pipe_dict","console_items","console_is_shrunk","height_fraction","show_exports_pane","console_is_zoomed"];class L extends React.Component{constructor(e){super(e),doBinding(this),this.table_container_ref=React.createRef(),this.tile_div_ref=React.createRef(),this.tbody_ref=React.createRef(),this.table_ref=React.createRef(),this.last_save={},this.resizing=!1;let t,s={mounted:!1,doc_names:e.initial_doc_names,short_collection_name:window.short_collection_name,console_items:[],awaiting_data:!1,console_is_shrunk:!0,show_exports_pane:!1,console_is_zoomed:!1,tile_types:{},tile_list:[],search_text:"",usable_width:window.innerWidth-2*k,usable_height:window.innerHeight-P,height_fraction:.85,alt_search_text:null,table_is_shrunk:!1,console_width_fraction:.5,horizontal_fraction:.65};if(t=window.is_freeform?{data_text:e.initial_data_text,table_spec:{current_doc_name:e.initial_doc_names[0]}}:{show_table_spinner:!1,data_row_dict:e.initial_data_row_dict,total_rows:e.total_rows,cells_to_color_text:{},force_row_to_top:null,selected_column:null,selected_row:null,table_is_filtered:!1,table_spec:{column_names:this.props.initial_column_names,column_widths:this.props.initial_column_widths,hidden_columns_list:this.props.initial_hidden_columns_list,current_doc_name:e.initial_doc_names[0]}},window.is_notebook&&(this.state.console_is_shrunk=!1),this.state=Object.assign(s,t),this.props.is_project){for(let e of z)this.state[e]=this.props.interface_state[e];for(let e of this.state.tile_list)e.finished_loading=!1}this.updateExportsList=null;let i=this;window.addEventListener("beforeunload",(function(e){i.dirty()&&(e.preventDefault(),e.returnValue="")}))}_update_window_dimensions(){this.setState({usable_width:window.innerWidth-2*k,usable_height:window.innerHeight-P})}_updateLastSave(){this.last_save=this.interface_state}dirty(){let e=this.interface_state;for(let t in e)if(e[t]!=this.last_save[t])return!0;return!1}componentDidMount(){this.setState({mounted:!0}),window.addEventListener("resize",this._update_window_dimensions),document.title=window.is_project?window._project_name:this.state.short_collection_name;let e=this;I.socket.on("table-message",(function(t){e._handleTableMessage(t)})),Object(b.f)("host","get_tile_types",{user_id:window.user_id},(function(t){e.setState({tile_types:t.tile_types})})),I.socket.on("update-menus",(function(){Object(b.f)("host","get_tile_types",{user_id:window.user_id},(function(t){e.setState({tile_types:t.tile_types})}))})),I.socket.on("change-doc",(function(t){let s=t.hasOwnProperty("row_id")?t.row_id:null;e.state.table_is_shrunk&&e.setState({table_is_shrunk:!1}),e._handleChangeDoc(t.doc_name,s)})),window.is_project||e.props.stopSpinner(),this._updateLastSave()}_createTileEntry(e,t,s,i){return{tile_name:e,tile_type:t,tile_id:s,form_data:i,tile_height:345,tile_width:410,show_form:!1,show_spinner:!1,source_changed:!1,javascript_code:null,javascript_arg_dict:null,show_log:!1,log_content:"",shrunk:!1,finished_loading:!0,front_content:""}}_setMainStateValue(e,t,s=null){let i={};i[e]=t,this.setState(i,s)}_handleSearchFieldChange(e){this.setState({search_text:e,alt_search_text:null}),null!=e||window.is_freeform||this.setState({cells_to_color_text:{}})}_setAltSearchText(e){this.setState({alt_search_text:e})}set_visible_doc(e,t){const s={doc_name:e};null===t?Object(b.f)(window.main_id,"set_visible_doc",s):Object(b.f)(window.main_id,"set_visible_doc",s,t)}_handleChangeDoc(e,t=0){let s=this;if(this.setState({show_table_spinner:!0}),window.is_freeform)Object(b.f)(window.main_id,"grab_freeform_data",{doc_name:e,set_visible_doc:!0},(function(t){s.props.stopSpinner(),s.props.clearStatusMessage();let i={current_doc_name:e};s.setState({data_text:t.data_text,table_spec:i},()=>{s.setState({show_table_spinner:!1})}),s.set_visible_doc(e)}));else{const i={doc_name:e,row_index:t,set_visible_doc:!0};Object(b.f)(main_id,"grab_chunk_by_row_index",i,(function(t){s._setStateFromDataObject(t,e,()=>{s.setState({show_table_spinner:!1})})}))}}_handleVerticalSplitUpdate(e,t,s){this.setState({height_fraction:s})}_updateTableSpec(e,t=!1){let s=Object.assign(this.state.table_spec,e);this.setState({table_spec:s}),t&&this._broadcast_event_to_server("UpdateTableSpec",e)}_broadcast_event_to_server(e,t,s){t.main_id=window.main_id,t.event_name=e,t.doc_name=this.state.table_spec.current_doc_name,Object(b.f)(main_id,"distribute_events_stub",t,s)}_tile_command(e){var t=[];for(let e of this.state.tile_list)t.push(e.tile_name);let s=this;Object(C.b)("Create "+e,"New Tile Name",(function(t){s.props.startSpinner(),s.props.statusMessage("Creating Tile "+t);const i={},o=e;i.tile_name=t,i.tile_type=o,i.user_id=window.user_id,i.parent=window.main_id,Object(b.f)(window.main_id,"create_tile",i,(function(i){if(i.success){let o=s._createTileEntry(t,e,i.tile_id,i.form_data),n=[...s.state.tile_list];n.push(o),s.setState({tile_list:n}),s.updateExportsList&&s.updateExportsList(),s.props.clearStatusMessage(),s.props.stopSpinner()}else s.props.addErrorDrawerEntry({title:"Error creating tile",content:data.message})}))}),e,t)}create_tile_menus(){let e=[];for(let t in this.state.tile_types){let s={};for(let e of this.state.tile_types[t])s[e]=()=>this._tile_command(e);e.push(React.createElement(g.b,{menu_name:t,option_dict:s,disabled_items:[],key:t}))}return e}_toggleTableShrink(){this.setState({table_is_shrunk:!this.state.table_is_shrunk,tile_sorter_exists:!1})}_handleHorizontalFractionChange(e,t,s){this.setState({horizontal_fraction:s})}_handleResizeStart(){this.resizing=!0}_handleResizeEnd(){this.resizing=!1}_handleConsoleFractionChange(e,t,s){this.setState({console_width_fraction:s})}_getTableBodyHeight(e){if(this.state.mounted&&this.tbody_ref.current){return e-(this.tbody_ref.current.getBoundingClientRect().top-this.table_container_ref.current.getBoundingClientRect().top)-(this.state.console_is_shrunk?2*O:O)}return e-50}compute_table_width(){let e=this;return this.state.table_spec.column_widths.reduce((function(t,s,i){return e.state.table_spec.hidden_columns_list.includes(e.state.table_spec.column_names[i])?t:t+s}))+M}_setFreeformDoc(e,t){e==this.state.table_spec.current_doc_name&&this.setState({data_text:t})}_handleTableMessage(e){let t=this;({refill_table:t._refill_table,dehighlightAllText:e=>t._handleSearchFieldChange(null),highlightTxtInDocument:e=>t._setAltSearchText(e.text_to_find),setCellContent:e=>t._setCellContent(e.row,e.column_header,e.new_content),colorTxtInCell:e=>t._colorTextInCell(e.row_id,e.column_header,e.token_text,e.color_dict),setFreeformContent:e=>t._setFreeformDoc(e.doc_name,e.new_content)})[e.table_message](e)}_setCellContent(e,t,s,i=!1){let o=Object.assign({},this.state.data_row_dict),n=Object.assign({},o[e]);n[t]=s,o[e]=n,this.setState({data_row_dict:o});let a={id:e,column_header:t,new_content:s,cellchange:!1};i&&this._broadcast_event_to_server("SetCellContent",a,null)}_colorTextInCell(e,t,s,i){let o,n=Object.assign({},this.state.cells_to_color_text);(o=n.hasOwnProperty(e)?Object.assign({},n[e]):{})[t]={token_text:s,color_dict:i},n[e]=o,this.setState({cells_to_color_text:n})}_refill_table(e){this._setStateFromDataObject(e,e.doc_name)}_moveColumn(e,t){let s=[...this.state.table_spec.column_names],i=s.indexOf(e);s.splice(i,1);let o=s.indexOf(t);s.splice(o,0,e);let n=this._filteredColumnNames();i=n.indexOf(e),n.splice(i,1),o=n.indexOf(t);let a=[...this.state.table_spec.column_widths],r=a[i];a.splice(i,1),a.splice(o,0,r),this._updateTableSpec({column_names:s,column_widths:a},!0)}_hideColumn(){let e=[...this.state.table_spec.hidden_columns_list],t=this._filteredColumnNames(),s=this.state.selected_column,i=t.indexOf(s),o=[...this.state.table_spec.column_widths];o.splice(i,1),e.push(s),this._updateTableSpec({hidden_columns_list:e,column_widths:o},!0)}_hideColumnInAll(){let e=[...this.state.table_spec.hidden_columns_list],t=this._filteredColumnNames(),s=this.state.selected_column,i=t.indexOf(s),o=[...this.state.table_spec.column_widths];o.splice(i,1),e.push(s),this._updateTableSpec({hidden_columns_list:e,column_widths:o},!1);const n={column_name:this.state.selected_column};this._broadcast_event_to_server("HideColumnInAllDocs",n)}_unhideAllColumns(){this._updateTableSpec({hidden_columns_list:["__filename__"]},!0)}_addColumn(e=!1){let t=this,s=e?"Create Column All Documents":"Create Column This Document";Object(C.b)(s,"New Column Name",(function(s){let i=function(e){let t=$($(".bp3-table-truncated-text")[0]).css("font"),s=document.getElementById("measure-canvas").getContext("2d");return s.font=t,s.measureText(e).width+40}(s);t._updateTableSpec({column_names:[...t.state.table_spec.column_names,s],column_widths:[...t.state.table_spec.column_widths,i]},!1);const o={column_name:s,doc_name:t.state.table_spec.current_doc_name,column_width:i,all_docs:e};t._broadcast_event_to_server("CreateColumn",o)}))}_setStateFromDataObject(e,t,s=null){this.setState({data_row_dict:e.data_row_dict,total_rows:e.total_rows,table_spec:{column_names:e.table_spec.header_list,column_widths:e.table_spec.column_widths,hidden_columns_list:e.table_spec.hidden_columns_list,current_doc_name:t}},s)}_initiateDataGrab(e){this.setState({awaiting_data:!0},()=>{this._grabNewChunkWithRow(e)})}_grabNewChunkWithRow(e){let t=this;Object(b.f)(window.main_id,"grab_chunk_by_row_index",{doc_name:this.state.table_spec.current_doc_name,row_index:e},(function(e){let s=Object.assign(t.state.data_row_dict,e.data_row_dict);t.setState({data_row_dict:s,awaiting_data:!1})}))}_changeCollection(){this.props.startSpinner();let e=this;function t(t){const s={new_collection_name:t,main_id:window.main_id};Object(b.f)(window.main_id,"change_collection",s,(function(s){s.success?(window.is_project||(document.title=t),window._collection_name=s.collection_name,e.setState({doc_names:s.doc_names,short_collection_name:s.short_collection_name},()=>{e._handleChangeDoc(s.doc_names[0])}),e.props.stopSpinner()):(e.props.clearStatusMessage(),e.props.stopSpinner(),e.props.addErrorDrawerEntry({title:"Error changing collection",content:s.message}))}))}Object(b.f)("host","get_collection_names",{user_id:user_id},(function(e){let s=e.collection_names,i=[];for(var o of s)i.push(o);Object(C.c)("Select New Collection","New Collection","Cancel","Submit",t,i)}))}get interface_state(){let e={};for(let t of z)e[t]=this.state[t];return e}get_hp_height(){return this.state.mounted&&this.tile_div_ref.current?this.state.console_is_shrunk?this.state.usable_height-this.tile_div_ref.current.getBoundingClientRect().top-j:(this.state.usable_height-this.tile_div_ref.current.getBoundingClientRect().top)*this.state.height_fraction:this.state.usable_height-100}get_vp_height(){return this.state.mounted&&this.tile_div_ref.current?this.state.usable_height-this.tile_div_ref.current.getBoundingClientRect().top:this.state.usable_height-50}_filteredColumnNames(){let e=this;return this.state.table_spec.column_names.filter(t=>!(e.state.table_spec.hidden_columns_list.includes(t)||"__id__"==t))}render(){let e,t,s;this.state.console_is_zoomed||window.is_notebook?s=this.state.usable_height-50:(e=this.get_vp_height(),t=this.get_hp_height(),s=this.state.console_is_shrunk?j:e-t-O-1);let o=[];this.state.selected_column||(o=["Shift Left","Shift Right","Hide","Hide in All Docs"]);let n=React.createElement(React.Fragment,null,React.createElement(g.c,S({},this.props.statusFuncs,{console_items:this.state.console_items,interface_state:this.interface_state,changeCollection:this._changeCollection,updateLastSave:this._updateLastSave,disabled_items:window.is_project?[]:["Save"],hidden_items:["Export as Jupyter Notebook"]})),!window.is_freeform&&React.createElement(g.a,S({},this.props.statusFuncs,{moveColumn:this._moveColumn,table_spec:this.state.table_spec,filtered_column_names:this._filteredColumnNames(),selected_column:this.state.selected_column,disabled_items:o,hideColumn:this._hideColumn,hideInAll:this._hideColumnInAll,unhideAllColumns:this._unhideAllColumns,addColumn:this._addColumn})),React.createElement(g.d,S({},this.props.statusFuncs,{table_is_shrunk:this.state.table_is_shrunk,toggleTableShrink:this._toggleTableShrink,openErrorDrawer:this.props.openErrorDrawer})),React.createElement(E.NavbarDivider,null),this.create_tile_menus()),a=t,p={display:"block",tableLayout:"fixed"};null!=this.state.table_spec.column_widths&&(p.width=this.compute_table_width());let _,h=React.createElement(l,{toggleShrink:this._toggleTableShrink,short_collection_name:this.state.short_collection_name,handleChangeDoc:this._handleChangeDoc,doc_names:this.state.doc_names,current_doc_name:this.state.table_spec.current_doc_name,show_table_spinner:this.state.show_table_spinner,handleSearchFieldChange:this._handleSearchFieldChange,search_text:this.state.search_text,setMainStateValue:this._setMainStateValue,table_is_filtered:this.state.table_is_filtered,show_filter_button:!window.is_freeform,broadcast_event_to_server:this._broadcast_event_to_server});_=window.is_freeform?React.createElement(r,{my_ref:this.tbody_ref,data_text:this.state.data_text,code_container_height:this._getTableBodyHeight(a),search_text:this.state.search_text,alt_search_text:this.state.alt_search_text}):React.createElement(d,{my_ref:this.tbody_ref,ref:this.table_ref,awaiting_data:this.state.awaiting_data,initiateDataGrab:this._initiateDataGrab,height:this._getTableBodyHeight(a),column_names:this.state.table_spec.column_names,setCellContent:this._setCellContent,filtered_column_names:this._filteredColumnNames(),moveColumn:this._moveColumn,column_widths:this.state.table_spec.column_widths,hidden_columns_list:this.state.table_spec.hidden_columns_list,updateTableSpec:this._updateTableSpec,setMainStateValue:this._setMainStateValue,selected_column:this.state.selected_column,selected_row:this.state.selected_row,search_text:this.state.search_text,alt_search_text:this.state.alt_search_text,cells_to_color_text:this.state.cells_to_color_text,total_rows:this.state.total_rows,broadcast_event_to_server:this._broadcast_event_to_server,data_row_dict:this.state.data_row_dict});let u,b=this.state.console_is_shrunk?a-O:a,y=React.createElement(f.a,{height:b,tile_div_ref:this.tile_div_ref,tile_list:this.state.tile_list,current_doc_name:this.state.table_spec.current_doc_name,table_is_shrunk:this.state.table_is_shrunk,selected_row:this.state.selected_row,broadcast_event:this._broadcast_event_to_server,setMainStateValue:this._setMainStateValue,tsocket:I});u=this.state.show_exports_pane?React.createElement(R,{setUpdate:e=>this.updateExportsList=e,available_height:s,console_is_shrunk:this.state.console_is_shrunk,console_is_zoomed:this.state.console_is_zoomed,tsocket:I}):React.createElement("div",null);let w,T=React.createElement(x.a,{console_items:this.state.console_items,console_is_shrunk:this.state.console_is_shrunk,console_is_zoomed:this.state.console_is_zoomed,show_exports_pane:this.state.show_exports_pane,setMainStateValue:this._setMainStateValue,console_available_height:s,tsocket:I}),C=React.createElement(m.c,{left_pane:T,right_pane:u,show_handle:!this.state.console_is_shrunk,available_height:s,available_width:this.state.usable_width,initial_width_fraction:this.state.console_width_fraction,controlled:!0,dragIconSize:15,handleSplitUpdate:this._handleConsoleFractionChange}),v=React.createElement(React.Fragment,null,React.createElement("div",{ref:this.table_container_ref},React.createElement(c,{card_body:_,card_header:h,table_spec:this.state.table_spec,broadcast_event_to_server:this._broadcast_event_to_server,updateTableSpec:this._updateTableSpec})));return w=this.state.table_is_shrunk?React.createElement(React.Fragment,null,y,this.state.console_is_shrunk&&C):React.createElement(React.Fragment,null,React.createElement(m.c,{left_pane:v,right_pane:y,available_height:t,show_handle:!0,scrollAdjustSelectors:[".bp3-table-quadrant-scroll-container","#tile-div"],available_width:this.state.usable_width,initial_width_fraction:this.state.horizontal_fraction,controlled:!0,dragIconSize:15,handleSplitUpdate:this._handleHorizontalFractionChange,handleResizeStart:this._handleResizeStart,handleResizeEnd:this._handleResizeEnd}),this.state.console_is_shrunk&&C),React.createElement(React.Fragment,null,React.createElement(i.a,{is_authenticated:window.is_authenticated,user_name:window.username,menus:n}),this.state.console_is_zoomed&&C,!this.state.console_is_zoomed&&this.state.console_is_shrunk&&w,!this.state.console_is_zoomed&&!this.state.console_is_shrunk&&React.createElement(m.d,{top_pane:w,bottom_pane:C,show_handle:!0,available_width:this.state.usable_width,available_height:e,initial_height_fraction:this.state.height_fraction,dragIconSize:15,scrollAdjustSelectors:[".bp3-table-quadrant-scroll-container","#tile-div"],handleSplitUpdate:this._handleVerticalSplitUpdate,handleResizeStart:this._handleResizeStart,handleResizeEnd:this._handleResizeEnd,overflow:"hidden"}))}}L.propTypes={interface_state:PropTypes.object,initial_doc_names:PropTypes.array,initial_column_names:PropTypes.array,initial_data_row_dict:PropTypes.object,initial_column_widths:PropTypes.array,initial_hidden_columns_list:PropTypes.array,doc_names:PropTypes.array};class B extends u.a{initialize_socket_stuff(){this.socket.emit("join",{room:user_id}),this.socket.on("handle-callback",b.a),this.socket.on("close-user-windows",(function(e){Object(b.e)("host","remove_mainwindow_task",{main_id:main_id}),e.originator!=main_id&&window.close()})),this.socket.on("stop-heartbeat",(function(e){clearInterval(D)})),this.socket.on("window-open",(function(e){window.open($SCRIPT_ROOT+"/load_temp_page/"+e.the_id)})),this.socket.on("notebook-open",(function(e){window.open($SCRIPT_ROOT+"/open_notebook/"+e.the_id)})),this.socket.on("doFlash",(function(e){Object(y.b)(e)}))}}console.log("entering start_post_load"),A=get_ppi(),(I=new B("main",5e3)).socket.emit("join-main",{room:main_id},(function(){!function(){if(window.is_project){let e={project_name:window._project_name,doc_type:window.doc_type,library_id:window.main_id,base_figure_url:window.base_figure_url,use_ssl:window.use_ssl,user_id:window.user_id,ppi:A};Object(b.f)(main_id,"initialize_project_mainwindow",e)}else{let e={collection_name:window._collection_name,doc_type:window.doc_type,base_figure_url:window.base_figure_url,use_ssl:window.use_ssl,user_id:window.user_id,ppi:A};Object(b.f)(main_id,"initialize_mainwindow",e)}}()})),I.socket.on("finish-post-load",N)}]);